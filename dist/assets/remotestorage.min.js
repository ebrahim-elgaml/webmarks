!function(a){function b(a){function c(a){if(f){var b;if(a.fulfilled)try{b=[a.fulfilled.apply(null,g)]}catch(c){return void a.promise.reject(c)}else b=g;b[0]&&"function"==typeof b[0].then?b[0].then(a.promise.fulfill,a.promise.reject):a.promise.fulfill.apply(null,b)}else if(a.rejected){var d;try{d=a.rejected.apply(null,g)}catch(c){return void a.promise.reject(c)}d&&"function"==typeof d.then?d.then(a.promise.fulfill,a.promise.reject):a.promise.fulfill(d)}else a.promise.reject.apply(null,g)}function d(a,b){return g?void console.error("WARNING: Can't resolve promise, already resolved!"):(f=a,g=Array.prototype.slice.call(b),void setTimeout(function(){var a=h.length;0!==a||f||console.error("Possibly uncaught error: ",g,g[0]&&g[0].stack);for(var b=0;a>b;b++)c(h[b]);h=void 0},0))}var e;"function"==typeof a&&setTimeout(function(){try{a(e)}catch(b){e.reject(b)}},0);var f,g,h=[];return e={then:function(a,d){var e={fulfilled:"function"==typeof a?a:void 0,rejected:"function"==typeof d?d:void 0,promise:b()};return g?setTimeout(function(){c(e)},0):h.push(e),e.promise},fulfill:function(){return d(!0,arguments),this},reject:function(){return d(!1,arguments),this}}}a.promising=b}("undefined"!=typeof window?window:global),function(a){function b(a){"string"==typeof a?console.error(a):console.error(a.message,a.stack)}function c(a){var b=Array.prototype.slice.call(arguments);(403===a||401===a)&&this._emit("error",new f.Unauthorized);var c=promising();return c.fulfill.apply(c,b)}function d(a){return"dropbox"===this.backend&&a.match(/^\/public\/.*[^\/]$/)}var e={get:function(a,b){return this.local?this.local.get(a,b):this.remote.get(a)},put:function(a,b,c){return d.bind(this)(a)?e._wrapBusyDone.call(this,this.remote.put(a,b,c)):this.local?this.local.put(a,b,c):e._wrapBusyDone.call(this,this.remote.put(a,b,c))},"delete":function(a){return this.local?this.local.delete(a):e._wrapBusyDone.call(this,this.remote.delete(a))},_wrapBusyDone:function(a){var b=this;return this._emit("wire-busy"),a.then(function(){var a=promising();return b._emit("wire-done",{success:!0}),a.fulfill.apply(a,arguments)},function(a){throw b._emit("wire-done",{success:!1}),a})}},f=function(){if(f.eventHandling(this,"ready","connected","disconnected","not-connected","conflict","error","features-loaded","connecting","authing","wire-busy","wire-done"),this._pending=[],this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),"delete":this._pendingGPD("delete")}),this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},this.localStorageAvailable()){try{this.apiKeys=JSON.parse(localStorage["remotestorage:api-keys"])}catch(a){}this.setBackend(localStorage["remotestorage:backend"]||"remotestorage")}var b=this.on;this.on=function(a,c){return"ready"===a&&this.remote.connected&&this._allLoaded?setTimeout(c,0):"features-loaded"===a&&this._allLoaded&&setTimeout(c,0),b.call(this,a,c)},this._init(),this.on("ready",function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this))};f.DiscoveryError=function(a){Error.apply(this,arguments),this.message=a},f.DiscoveryError.prototype=Object.create(Error.prototype),f.Unauthorized=function(){Error.apply(this,arguments)},f.Unauthorized.prototype=Object.create(Error.prototype),f.log=function(){f._log&&console.log.apply(console,arguments)},f.prototype={connect:function(a){if(this.setBackend("remotestorage"),a.indexOf("@")<0)return void this._emit("error",new f.DiscoveryError("User adress doesn't contain an @."));this.remote.configure(a),this._emit("connecting");var b=setTimeout(function(){this._emit("error",new f.DiscoveryError("No storage information found at that user address."))}.bind(this),5e3);f.Discover(a,function(c,d,e){return clearTimeout(b),c?(this._emit("authing"),this.remote.configure(a,c,d),void(this.remote.connected||this.authorize(e))):void this._emit("error",new f.DiscoveryError("Failed to contact storage server."))}.bind(this))},disconnect:function(){this.remote&&this.remote.configure(null,null,null,null),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),"delete":this._pendingGPD("delete")});var a=this._cleanups.length,b=0,c=function(){b++,b>=a&&(this._init(),f.log("Done cleaning up, emitting disconnected and disconnect events"),this._emit("disconnected"))}.bind(this);a>0?this._cleanups.forEach(function(a){var b=a(this);"object"==typeof a&&"function"==typeof a.then?b.then(c):c()}.bind(this)):c()},setBackend:function(a){this.backend=a,this.localStorageAvailable()&&(a?localStorage["remotestorage:backend"]=a:delete localStorage["remotestorage:backend"])},onChange:function(a,b){this._pathHandlers.change[a]||(this._pathHandlers.change[a]=[]),this._pathHandlers.change[a].push(b)},enableLog:function(){f._log=!0},disableLog:function(){f._log=!1},log:function(){f.log.apply(f,arguments)},setApiKeys:function(a,b){b?this.apiKeys[a]=b:delete this.apiKeys[a],this.localStorageAvailable()&&(localStorage["remotestorage:api-keys"]=JSON.stringify(this.apiKeys))},_init:function(){function a(){try{d||(c._emit("ready"),d=!0)}catch(a){console.error("'ready' failed: ",a,a.stack),c._emit("error",a)}}var c=this,d=!1;this._loadFeatures(function(d){this.log("[RemoteStorage] All features loaded"),this.local=d.local&&new d.local,this.local&&this.remote?(this._setGPD(e,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",function(){a(),c._emit("connected")}),this.remote.on("not-connected",function(){a(),c._emit("not-connected")}),this.remote.connected&&(a(),c._emit("connected"))),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(f){b(f),this._emit("error",f)}this._processPending()}.bind(this))},_collectCleanupFunctions:function(){for(var a=0;a<this.features.length;a++){var b=this.features[a].cleanup;"function"==typeof b&&this._cleanups.push(b)}},_loadFeatures:function(a){function b(){j++,j===h.length&&setTimeout(function(){i.caching=!!f.Caching,i.sync=!!f.Sync,["IndexedDB","LocalStorage","InMemoryStorage"].some(function(a){return i.some(function(b){return b.name===a})?(i.local=f[a],!0):void 0}),k.features=i,a(i)},0)}function c(a){k.log("[RemoteStorage] [FEATURE "+a+"] initialized."),i.push({name:a,init:f[a]._rs_init,supported:!0,cleanup:f[a]._rs_cleanup}),b()}function d(a,c){k.log("[RemoteStorage] [FEATURE "+a+"] initialization failed ( "+c+")"),b()}function e(a,c){k.log("[RemoteStorage] [FEATURE "+a+"]"+c?"":" not supported"),c||b()}function g(a){var b;try{b=f[a]._rs_init(k)}catch(e){return void d(a,e)}"object"==typeof b&&"function"==typeof b.then?b.then(function(){c(a)},function(b){d(a,b)}):c(a)}var h=["WireClient","I18n","Dropbox","GoogleDrive","Access","Caching","Discover","Authorize","Widget","IndexedDB","LocalStorage","InMemoryStorage","Sync","BaseClient","Env"],i=[],j=0,k=this;h.forEach(function(a){k.log("[RemoteStorage] [FEATURE "+a+"] initializing...");var b,c=f[a];c?(b=!c._rs_supported||c._rs_supported(),"object"==typeof b?b.then(function(){e(a,!0),g(a)},function(){e(a,!1)}):"boolean"==typeof b&&(e(a,b),b&&g(a))):e(a,!1)})},localStorageAvailable:function(){try{return!!a.localStorage}catch(b){return!1}},_setGPD:function(a,b){function d(a){return function(){return a.apply(b,arguments).then(c.bind(this))}}this.get=d(a.get),this.put=d(a.put),this.delete=d(a.delete)},_pendingGPD:function(a){return function(){var b=promising();return this._pending.push({method:a,args:Array.prototype.slice.call(arguments),promise:b}),b}.bind(this)},_processPending:function(){this._pending.forEach(function(a){try{this[a.method].apply(this,a.args).then(a.promise.fulfill,a.promise.reject)}catch(b){a.promise.reject(b)}}.bind(this)),this._pending=[]},_bindChange:function(a){a.on("change",this._dispatchEvent.bind(this,"change"))},_dispatchEvent:function(a,b){for(var c in this._pathHandlers[a]){var d=c.length,e=this;this._pathHandlers[a][c].forEach(function(a){if(b.path.substr(0,d)===c){var f={};for(var g in b)f[g]=b[g];f.relativePath=b.path.replace(new RegExp("^"+c),"");try{a(f)}catch(h){console.error("'change' handler failed: ",h,h.stack),e._emit("error",h)}}})}}},Object.defineProperty(f.prototype,"connected",{get:function(){return this.remote.connected}}),a.RemoteStorage=f}("undefined"!=typeof window?window:global),function(){var a={addEventListener:function(a,b){if("string"!=typeof a)throw new Error("Argument eventName should be a string");if("function"!=typeof b)throw new Error("Argument handler should be a function");RemoteStorage.log("[Eventhandling] Adding event listener",a,b),this._validateEvent(a),this._handlers[a].push(b)},removeEventListener:function(a,b){this._validateEvent(a);for(var c=this._handlers[a].length,d=0;c>d;d++)if(this._handlers[a][d]===b)return void this._handlers[a].splice(d,1)},_emit:function(a){this._validateEvent(a);var b=Array.prototype.slice.call(arguments,1);this._handlers[a].forEach(function(a){a.apply(this,b)})},_validateEvent:function(a){if(!(a in this._handlers))throw new Error("Unknown event: "+a)},_delegateEvent:function(a,b){b.on(a,function(b){this._emit(a,b)}.bind(this))},_addEvent:function(a){this._handlers[a]=[]}};a.on=a.addEventListener,RemoteStorage.eventHandling=function(b){var c=Array.prototype.slice.call(arguments,1);for(var d in a)b[d]=a[d];b._handlers={},c.forEach(function(a){b._addEvent(a)})}}("undefined"!=typeof window?window:global),function(a){function b(a){return"string"!=typeof a?a:"*"===a?"*":'"'+a+'"'}function c(a){return"string"!=typeof a?a:a.replace(/^["']|["']$/g,"")}function d(a,b,c){var d=new Blob([a],{type:b}),e=new FileReader;e.addEventListener("loadend",function(){c(e.result)}),e.readAsArrayBuffer(d)}function e(a){return a.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/")}function f(a){return"/"===a.substr(-1)}function g(a){return"http://remotestorage.io/spec/folder-description"===a["@context"]&&"object"==typeof a.items}function h(a){return[201,204,304].indexOf(a)>=0}function i(a){return[401,403,404,412].indexOf(a)>=0}var j,k,l=RemoteStorage,m="remotestorage:wireclient",n=1,o=2,p=3,q=4,r=5,s={"draft-dejong-remotestorage-00":o,"draft-dejong-remotestorage-01":p,"draft-dejong-remotestorage-02":q,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":n};if("function"==typeof ArrayBufferView)k=function(a){return a&&a instanceof ArrayBufferView};else{var t=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];k=function(a){for(var b=0;8>b;b++)if(a instanceof t[b])return!0;return!1}}var u;l.WireClient=function(a){if(this.connected=!1,l.eventHandling(this,"change","connected","wire-busy","wire-done","not-connected"),u=function(a){a instanceof RemoteStorage.Unauthorized&&this.configure(void 0,void 0,void 0,null)}.bind(this),a.on("error",u),j){var b;try{b=JSON.parse(localStorage[m])}catch(c){}b&&setTimeout(function(){this.configure(b.userAddress,b.href,b.storageApi,b.token)}.bind(this),0)}this._revisionCache={},this.connected&&setTimeout(this._emit.bind(this),0,"connected")},l.WireClient.REQUEST_TIMEOUT=3e4,l.WireClient.prototype={_request:function(a,b,d,e,g,j,k){if(("PUT"===a||"DELETE"===a)&&"/"===b[b.length-1])throw"Don't "+a+" on directories!";var m,n=promising(),o=this;return e.Authorization="Bearer "+d,this._emit("wire-busy",{method:a,isFolder:f(b)}),l.WireClient.request(a,b,{body:g,headers:e},function(d,e){if(d)o._emit("wire-done",{method:a,isFolder:f(b),success:!1}),o.online=!1,n.reject(d);else if(o._emit("wire-done",{method:a,isFolder:f(b),success:!0}),o.online=!0,i(e.status))RemoteStorage.log("[WireClient] Error response status",e.status),m=j?c(e.getResponseHeader("ETag")):void 0,n.fulfill(e.status,void 0,void 0,m);else if(h(e.status)||200===e.status&&"GET"!==a)m=c(e.getResponseHeader("ETag")),RemoteStorage.log("[WireClient] Successful request",m),n.fulfill(e.status,void 0,void 0,m);else{var g,p=e.getResponseHeader("Content-Type");m=j?c(e.getResponseHeader("ETag")):200===e.status?k:void 0,!p||p.match(/charset=binary/)?l.WireClient.readBinaryData(e.response,p,function(a){RemoteStorage.log("[WireClient] Successful request with unknown or binary mime-type",m),n.fulfill(e.status,a,p,m)}):(g=p&&p.match(/^application\/json/)?JSON.parse(e.responseText):e.responseText,RemoteStorage.log("[WireClient] Successful request",m),n.fulfill(e.status,g,p,m))}}),n},configure:function(a,b,c,d){"undefined"!=typeof a&&(this.userAddress=a),"undefined"!=typeof b&&(this.href=b),"undefined"!=typeof c&&(this.storageApi=c),"undefined"!=typeof d&&(this.token=d),"undefined"!=typeof this.storageApi&&(this._storageApi=s[this.storageApi]||r,this.supportsRevs=this._storageApi>=o),this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,j&&(localStorage[m]=JSON.stringify({userAddress:this.userAddress,href:this.href,token:this.token,storageApi:this.storageApi})),l.WireClient.configureHooks.forEach(function(a){a.call(this)}.bind(this))},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},get:function(a,c){if(!this.connected)throw new Error("not connected (path: "+a+")");c||(c={});var d={};if(this.supportsRevs)c.ifNoneMatch&&(d["If-None-Match"]=b(c.ifNoneMatch));else if(c.ifNoneMatch){this._revisionCache[a]}var h=this._request("GET",this.href+e(a),this.token,d,void 0,this.supportsRevs,this._revisionCache[a]);return f(a)?h.then(function(b,c,d,e){var f={};if(200===b&&"object"==typeof c){if(0===Object.keys(c).length)b=404;else if(g(c)){for(var h in c.items)this._revisionCache[a+h]=c.items[h].ETag;f=c.items}else Object.keys(c).forEach(function(b){this._revisionCache[a+b]=c[b],f[b]={ETag:c[b]}}.bind(this));return promising().fulfill(b,f,d,e)}return promising().fulfill(b,c,d,e)}.bind(this)):h},put:function(a,c,d,f){if(!this.connected)throw new Error("not connected (path: "+a+")");f||(f={}),d.match(/charset=/)||(d+="; charset="+(c instanceof ArrayBuffer||k(c)?"binary":"utf-8"));var g={"Content-Type":d};return this.supportsRevs&&(f.ifMatch&&(g["If-Match"]=b(f.ifMatch)),f.ifNoneMatch&&(g["If-None-Match"]=b(f.ifNoneMatch))),this._request("PUT",this.href+e(a),this.token,g,c,this.supportsRevs)},"delete":function(a,c){if(!this.connected)throw new Error("not connected (path: "+a+")");c||(c={});var d={};return this.supportsRevs&&c.ifMatch&&(d["If-Match"]=b(c.ifMatch)),this._request("DELETE",this.href+e(a),this.token,d,void 0,this.supportsRevs)}},l.WireClient.cleanPath=e,l.WireClient.isArrayBufferView=k,l.WireClient.readBinaryData=d,l.WireClient.request=function(a,b,c,d){RemoteStorage.log("[WireClient]",a,b),d=d.bind(this);var e=!1,f=setTimeout(function(){e=!0,d("timeout")},l.WireClient.REQUEST_TIMEOUT),g=new XMLHttpRequest;if(g.open(a,b,!0),c.responseType&&(g.responseType=c.responseType),c.headers)for(var h in c.headers)g.setRequestHeader(h,c.headers[h]);g.onload=function(){e||(clearTimeout(f),d(null,g))},g.onerror=function(a){e||(clearTimeout(f),d(a))};var i=c.body;"object"==typeof i&&(k(i)||(i=i instanceof ArrayBuffer?new Uint8Array(i):JSON.stringify(i))),g.send(i)},Object.defineProperty(RemoteStorage.WireClient.prototype,"storageType",{get:function(){if(this.storageApi){var a=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return a?a[1]:"2012.04"}}}),l.WireClient.configureHooks=[],l.WireClient._rs_init=function(a){j=a.localStorageAvailable(),a.remote=new l.WireClient(a),this.online=!0},l.WireClient._rs_supported=function(){return!!a.XMLHttpRequest},l.WireClient._rs_cleanup=function(a){j&&delete localStorage[m],a.removeEventListener("error",u)}}("undefined"!=typeof window?window:global),function(a){var b,c,d="remotestorage:discover",e={};RemoteStorage.Discover=function(a,b){function f(){var g=new XMLHttpRequest,h=j.shift();return h?(RemoteStorage.log("[Discover] Trying URL",h),g.open("GET",h,!0),g.onabort=g.onerror=function(){console.error("webfinger error",arguments,"(",h,")"),f()},g.onload=function(){if(200!==g.status)return f();var h;try{h=JSON.parse(g.responseText)}catch(i){return RemoteStorage.log("[Discover] Failed to parse profile ",g.responseText,i),void f()}if(!h.links)return RemoteStorage.log("[Discover] Profile has no links section ",JSON.stringify(h)),void f();var j;if(h.links.forEach(function(a){"remotestorage"===a.rel?j=a:"remoteStorage"!==a.rel||j||(j=a)}),RemoteStorage.log("[Discover] Got profile",h,"and link",j),j){var k=j.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||j.properties["auth-endpoint"],l=j.properties["http://remotestorage.io/spec/version"]||j.type;e[a]={href:j.href,type:l,authURL:k},c&&(localStorage[d]=JSON.stringify({cache:e})),b(j.href,l,k)}else f()},void g.send()):b()}if(a in e){var g=e[a];return void b(g.href,g.type,g.authURL)}var h=a.split("@")[1],i="?resource="+encodeURIComponent("acct:"+a),j=["https://"+h+"/.well-known/webfinger"+i,"https://"+h+"/.well-known/host-meta.json"+i,"http://"+h+"/.well-known/webfinger"+i,"http://"+h+"/.well-known/host-meta.json"+i];f()},RemoteStorage.Discover._rs_init=function(a){if(c=a.localStorageAvailable()){var b;try{b=JSON.parse(localStorage[d])}catch(f){}b&&(e=b.cache)}},RemoteStorage.Discover._rs_supported=function(){return b=!!a.XMLHttpRequest},RemoteStorage.Discover._rs_cleanup=function(){c&&delete localStorage[d]}}("undefined"!=typeof window?window:global),function(a){function b(){var a,b=RemoteStorage.Authorize.getLocation(),c=b.href.indexOf("#");if(-1!==c&&(a=b.href.substring(c+1),-1!==a.indexOf("=")))return a.split("&").reduce(function(a,b){var c=b.split("=");return a[decodeURIComponent(c[0])]=decodeURIComponent(c[1]),a},{})}RemoteStorage.Authorize=function(a,b,c,d){RemoteStorage.log("[Authorize] authURL = ",a);var e=a;e+=a.indexOf("?")>0?"&":"?",e+="redirect_uri="+encodeURIComponent(c.replace(/#.*$/,"")),e+="&scope="+encodeURIComponent(b),e+="&client_id="+encodeURIComponent(d),e+="&response_type=token",RemoteStorage.Authorize.setLocation(e)},RemoteStorage.prototype.authorize=function(a){this.access.setStorageType(this.remote.storageType);var b=this.access.scopeParameter,c=String(RemoteStorage.Authorize.getLocation()),d=c.match(/^(https?:\/\/[^\/]+)/)[0];RemoteStorage.Authorize(a,b,c,d)},RemoteStorage.Authorize.getLocation=function(){return a.document.location},RemoteStorage.Authorize.setLocation=function(b){if("string"==typeof b)a.document.location.href=b;else{if("object"!=typeof b)throw"Invalid location "+b;a.document.location=b}},RemoteStorage.Authorize._rs_supported=function(){return"undefined"!=typeof document};var c;RemoteStorage.Authorize._rs_init=function(a){c=function(){var b=!1;if(e){if(e.error)throw"Authorization server errored: "+e.error;e.access_token&&(a.remote.configure(void 0,void 0,void 0,e.access_token),b=!0),e.remotestorage&&(a.connect(e.remotestorage),b=!0)}b||a.remote.stopWaitingForToken()};var d,e=b();e&&(d=RemoteStorage.Authorize.getLocation(),d.hash=""),a.on("features-loaded",c)},RemoteStorage.Authorize._rs_cleanup=function(a){a.removeEventListener("features-loaded",c)}}("undefined"!=typeof window?window:global),function(){RemoteStorage.Access=function(){this.reset()},RemoteStorage.Access.prototype={claim:function(a,b){if("string"!=typeof a||-1!==a.indexOf("/")||0===a.length)throw new Error("Scope should be a non-empty string without forward slashes");if(!b.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(a),this.scopeModeMap[a]=b},get:function(a){return this.scopeModeMap[a]},remove:function(a){var b,c={};for(b in this.scopeModeMap)c[b]=this.scopeModeMap[b];this.reset(),delete c[a];for(b in c)this.set(b,c[b])},checkPermission:function(a,b){var c=this.get(a);return c&&("r"===b||"rw"===c)},checkPathPermission:function(a,b){return this.checkPermission("*",b)?!0:!!this.checkPermission(this._getModuleName(a),b)},reset:function(){this.rootPaths=[],this.scopeModeMap={}},_getModuleName:function(a){if("/"!==a[0])throw new Error("Path should start with a slash");var b=a.replace(/^\/public/,"").match(/^\/([^\/]*)\//);return b?b[1]:"*"},_adjustRootPaths:function(a){"*"in this.scopeModeMap||"*"===a?this.rootPaths=["/"]:a in this.scopeModeMap||(this.rootPaths.push("/"+a+"/"),this.rootPaths.push("/public/"+a+"/"))},_scopeNameForParameter:function(a){if("*"===a.name&&this.storageType){if("2012.04"===this.storageType)return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return a.name},setStorageType:function(a){this.storageType=a}},Object.defineProperty(RemoteStorage.Access.prototype,"scopes",{get:function(){return Object.keys(this.scopeModeMap).map(function(a){return{name:a,mode:this.scopeModeMap[a]}}.bind(this))}}),Object.defineProperty(RemoteStorage.Access.prototype,"scopeParameter",{get:function(){return this.scopes.map(function(a){return this._scopeNameForParameter(a)+":"+a.mode}.bind(this)).join(" ")}}),Object.defineProperty(RemoteStorage.prototype,"access",{get:function(){var a=new RemoteStorage.Access;return Object.defineProperty(this,"access",{value:a}),a},configurable:!0}),RemoteStorage.Access._rs_init=function(){}}("undefined"!=typeof window?window:global),function(a){var b=a,c={},d=!1;RemoteStorage.Env=function(){return c},RemoteStorage.Env.isBrowser=function(){return"browser"===b},RemoteStorage.Env.isNode=function(){return"node"===b},RemoteStorage.Env.goBackground=function(){d=!0,RemoteStorage.Env._emit("background")},RemoteStorage.Env.goForeground=function(){d=!1,RemoteStorage.Env._emit("foreground")},RemoteStorage.Env._rs_init=function(){RemoteStorage.eventHandling(RemoteStorage.Env,"background","foreground"),"browser"===b&&("undefined"!=typeof document.hidden?(c.hiddenProperty="hidden",c.visibilityChangeEvent="visibilitychange"):"undefined"!=typeof document.mozHidden?(c.hiddenProperty="mozHidden",c.visibilityChangeEvent="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(c.hiddenProperty="msHidden",c.visibilityChangeEvent="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(c.hiddenProperty="webkitHidden",c.visibilityChangeEvent="webkitvisibilitychange"),document.addEventListener(c.visibilityChangeEvent,function(){document[c.hiddenProperty]?RemoteStorage.Env.goBackground():RemoteStorage.Env.goForeground()},!1))},RemoteStorage.Env._rs_cleanup=function(){}}("undefined"!=typeof window?"browser":"node"),function(){"use strict";var a={view_info:'This app allows you to use your own storage. <a href="http://remotestorage.io/" target="_blank">Learn more!</a>',view_connect:"<strong>Connect</strong> remote storage",view_connecting:"Connecting <strong>%s</strong>",view_offline:"Offline",view_error_occured:"Sorry! An error occured.",view_confirm_reset:"Are you sure you want to reset everything? This will clear your local data and reload the page.",view_get_me_out:"Get me out of here!",view_error_plz_report:'If this problem persists, please <a href="http://remotestorage.io/community/" target="_blank">let us know</a>!',view_unauthorized:"Unauthorized! Click here to reconnect."};RemoteStorage.I18n={translate:function(){var b=arguments[0],c=Array.prototype.splice.call(arguments,1);if("string"!=typeof a[b])throw"Unknown translation string: "+b;return b=a[b],b.replace(/%s/g,function(){return c.shift()})},getDictionary:function(){return a},setDictionary:function(b){a=b}}}(),RemoteStorage.Assets={connectIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMTAzNi40KSI+CiAgPHBhdGggZD0ibTEgMTA0Ny40di02aDd2LTRsNyA3LTcgN3YtNHoiIGZpbGw9IiNmZmYiLz4KIDwvZz4KPC9zdmc+Cg==",disconnectIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4wIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxwYXRoIHN0eWxlPSJibG9jay1wcm9ncmVzc2lvbjp0Yjt0ZXh0LWluZGVudDowO2NvbG9yOiMwMDAwMDA7dGV4dC10cmFuc2Zvcm06bm9uZSIgZD0ibTguMDAwMSAwYy0wLjQ3MTQgMC0wLjk2MTAzIDAuNTQxOS0wLjk1IDF2NmMtMC4wMDc0NyAwLjUyODMxIDAuNDIxNjMgMSAwLjk1IDFzMC45NTc0Ny0wLjQ3MTY5IDAuOTUtMXYtNmMwLjAxNDYyMi0wLjYwNTEtMC40Nzg2LTEtMC45NS0xem0tMy4zNDM4IDIuNWMtMC4wODcxODYgMC4wMTkyOTQtMC4xNzE2MyAwLjA1MDk1OS0wLjI1IDAuMDkzNzUtMi45OTk1IDEuNTcxNS0zLjkxODQgNC43OTc5LTMuMTI1IDcuNDY4OCAwLjc5MzQgMi42NyAzLjI3OTkgNC45MzcgNi42ODc1IDQuOTM3IDMuMzU5MiAwIDUuODc3Mi0yLjE0OSA2LjcxOTItNC43ODEgMC44NDEtMi42MzIxLTAuMDU4LTUuODIzNC0zLjEyNS03LjU5NC0wLjQzNC0wLjI1MzYtMS4wNTktMC4wODk5LTEuMzEzIDAuMzQzNy0wLjI1MzYgMC40MzM2LTAuMDkgMS4wNTg5IDAuMzQ0IDEuMzEyNSAyLjM5MDggMS4zNzk4IDIuODgyNSAzLjQ5NDQgMi4yODEyIDUuMzc1LTAuNjAxMiAxLjg4MDYtMi4zNDQgMy40Mzc1LTQuOTA2MiAzLjQzNzUtMi41NzU5IDAtNC4yOTc2LTEuNjUwMi00Ljg3NS0zLjU5MzgtMC41Nzc2LTEuOTQzNS0wLjA0Ny00LjA0OCAyLjE4NzMtNS4yMTg3IDAuMzc4Ny0wLjIwNjMgMC41NzkxLTAuNjkyNSAwLjQ1NTgtMS4xMDU3LTAuMTIzMi0wLjQxMzMtMC41NTcyLTAuNzEwMy0wLjk4Ny0wLjY3NTUtMC4wMzEzLTAuMDAxNS0wLjA2MjYtMC4wMDE1LTAuMDkzOCAweiIgZmlsbD0iI2ZmZiIvPgo8L3N2Zz4K",dropbox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QgPEBAhEOpfuQAABhZJREFUWMPVl31snVUdxz+/5/2577e3b7QbHaOD0nXshW4ZZkpGQmJYZkJUDAaZzCBGAxGd+pdZQsJIjCaKgFu09GWybIggm8yhMCsY92rcOkPHunbdtKOUbX36svX23uc+xz+eDsrWlztiNJzk5D7JPS+fc8739/2dA5+EsqJtyK18ZlCKbX9Lk6fd1uo5xbTVZmtwa4v35Np5Mry4TLYXCzAnyhsry2SwrmnokdnaTruq6i3e0lXl0tqQlkURCxwdDp9Th5p3+p9iS8afqk/VZq9kaZoDN8apdU3B1KFnmLde7AkezH0n3V0UQOJpz2hIsqEhLU+WOeAagmtCxISYBe1nVf4vfWrByYdSpyf3W9ziLapy6JgbAduAiBn2S1rCQBYODAQP7H01/zxby4JpAW5s8mproxypiRKNGIJrQNT8EMA1wTGEU8MBP/q7umPw0dSbAA3N3n3zI2yLG2oScPgbNYWICY4Be86o/le6g0W576bPXQWwcqvXdJ2t1idMsA1hJoCoCRfGYdOhwsa4TUWFrr7pGmDrzAiQCHfD//Xxwk/33Z/6HoA0tnhLXZ3XMoYqsy4PYs4M4Ohg6pB2ddqO+vR6BWL27AARXbBNiBjwh9Oqs+O8ukcT4eaopjLqGsJSCdSX29SX23x/lctXlzgE1zBAANxWIQuGxlWNACxr8WozJp0lljKsGXbA0qGu1GRBxsTUQRAGLgboIuQVvHI8S+f7eeK2TLsDSQd296rhPaeDm09+PdX/gQYqN3uZ+jh7ro+oRusKDdgmVEY1GqstSiOhdegCmoQAIoImIWTPYIHdXVlyBYhaVwLA70+rPz7fllvLi2W5KcPw9q3eS/VJ7kmYgm1A3BIWV5osq7IIlMLUQJOrAXQBXQtr1BR2d2XpOu8TtULR+gq2nQh+vv8rqUdnNaKGZm/9qnJpmp/U+fxCB5lYsaGFdTYAY9L3jmNj9F9S7OgKVh9/KNVelBVf8untv8TYSS8gbsrHyh8C2LqQtGE0z9CJYfVuUblgRZv3WGOJvJG0cF8/lWPNdo+O93xsHYoVuqkL/xzIs/HPHt2DPg0Zko+v0I8vbfHun9aKE5sH9YaobJsf5V4mRLXv33kSlmAYwspqgw23R7A1EJlahKYOSsHTB0cZHQ9IOBA3NSrjGo4hWAY82xH8rH1b/jF2laoPAOb80jPqYtKTMdRcTQNd+xAgbgmuJbiGELfh3lsc7q41KQSTABBcC1qPjLH/XzniNqScsP1kgMsm9nJ34e2mNcmFAMby1qFPZyz1WlxXrprhuEUgUPDbd8Y59n6edbe61KZ1TF14vSfPLw5dYjhXIOMIM6lGAV+u0+tv+ttI/2+6/LsMQVXpUFCAqJkS9MT5anB2NGDjWxf5Yp3DvjN5th/LUhETolaRTqigxMGIWVKtHVyX2tGTJd2X5agUIfi8CmvUFOKGT++gT8wqLlKUgnwATxwq7P32m35Z+32pPQZA54MpH1iSb/XWZmx2VthTD1AATCBlCZ+dpwNg6EJjlUH3hQIKRaCujhZFaOPtfUH+8HvBnQceSP11yjA8vC616+A5FevL8jt/YiCR0HiQcAUVrnDHHO0jHTUNllXrpC0NRXiefjAxM4rhHLzQpZqf+eFFd/LkM17JGlu9p+xC8IgPhGlaqE1rNJZrxOzQok0dnjviY+nhbSntCH3DAWN+QMIWEhYsqTD4wYHChrPfSP9kqnmM6QAMkYtz4xqmDqeGA+rLNObGZVozkglx1ZfqZAvC2ZGAz9RYlEbAlsLoNd+Kx5RqO5/njKXDsnKdhCXFOaFAZUzjznlhyt5xIjiSLbBz2oVO98fRdalOoGZ5m/dUQ4pvJZ3Zr/CXlS5A74gabzlYePztr6U2faxr+eRy/RYvtjgjHauvkxvi9oTDXaGBuAUJWyh1hb3vqsOvfiG5/L/yMAE483BqdNeuXO3LvcGX3vEUhsZVsaYL9IzACz3BXcVOXvQOfKRsupBZv8R4bnW19rmqGPzqHz4BcMGn5U/Hgod5oiT3P3kvVj7rrfnx/pHBu7d7Azc1eY3/l0drzWbPXNjsGXySy38AbtMqneWU7BkAAAAASUVORK5CYII=",googledrive:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QgPEA85ztzJcQAABZVJREFUWMPtl1uoXVcVhr8x5tprn7M1NG1i0pQqSG2jLcXipYJXjPogqFgpaHMSFUkpIjU+leKbDxIQSiHgjZgmrfXgQ6SKj5Ji7YVS05aUUqKQlNLQeDnN5Zzk9Jy99xy/D3OttU/StDlV33TBZM3FXmuMf/5jjv+fG/7XL1vti9tnv3Dtnnf+87JY8YmZNxEMM1sZ7tWpjz764mriVqvKvmfb1ONLy3+dGyWu6EWbvQwoydv5BMSqFuereakmfnls1GP25IDaBGYYjplhljDz5tk7YMtPfurAf6UE9Z6tNwDPAPXwtcxL1x9n4zRgDjjm1gCyC6JpCLoW/OX65of1nzCwG6gNo3aYeXF981mTvK2/WWFiMmoj7X+z5JcE0N87c4e7b3EvyTwZT5/r8ezZHu6GuWGpSegJ8/ZeBu6fHv35s1/7t0rQv29mjWF/ATZ1L4bQwohrpkYc/sBpwhJYAVdKYECzYAESIk4Am3sf+sPCW2LAzb9jbpvMDXfD3fEqkRIcGdbsevlt9LylPYG1K6/K3QzK75uAr78lBgb3b7sc2cl2Uaa21sDiGMvB2iQeu/EMm6bKHjD3SUsCEChnpEAKiLisd/PB+UsyMPjZNwzzh1ixcnOfsFCX51NU/PTvA6pkTUdYw4R3zyu1ArMDqyvBQB82+FiJUQJ4C8YgVT1SSvSTs+vEmkcwe7qEsUnt233Aij0BW4ZPbfngKpRQs7hXpYQNvRiuEtATWOW4bLi+z04pJbCnBAkBJggBQlIBIZCUJM0Cm9+QgcED2+/G7BprdMZaAFZExm1FWcz+NLdj32G/6XfPCB5GoJKp7H5FARHRtgRI1y0/+cm7Lwpg+v7t64DvNd5S2mqirKXHy6RoArp1Ykrc2hKtKCtXlNEyoQ6Ydi498fF1F2FAdwEbV9UnZne+8q19Z7o63vTb+TPnRneeWxwxHGdyziii6wApQNEydKUUd5wHYGrftvci7tKKLSME5bvCaruynI9rNL7vdZgiHhiP898Wl8bMnxty+uyIhcURo1FgjSg1DCDph4uPfuR9AFbvvS25p2cxbiyKVuh2o1O44n2lLLacb5v75v5fX6yl5h753IwUD+YcRAQ5B6FMMhj0jboSRhnAE258wvp7Z7aYcbCYCeCGt97ubfICLDP/q4WZ32x7M20fPfb+hxbH9ZdjHOQIIoR74EDywA3coa6MqtJnrP+LmRmcB63ob8dA1wllRm95LVc//22S16TGeKqqpqoHk10ESGJj/zjjgIhAISKCyJmcY6Uu8Pbq7C0V6ABh35dzvYWQG0QAhmSYCaUlNhzdCrlX2jpE6tV4b9DYcGFKEgG8svQucoicC4CsII8zeTxutAEQzx1duPL3vrxjdlnou0SDLdTulxJQmalXNzN98jpEJiSo+qTeoEnsnWC5lVZNRhkOZiq0G8XCmz1gpp3j/ZYdYLhj9qCkn3fJQ4QKeh9OccWxz6O0hGKM9wakeoBEZ1BmqfOMyYFk4gXS+edG4J4ju6/644VK+AOJhSIYpVRBpn/qPVRL65A51dRavJoG2UQkOqf0hgVrGG7u6syoJDObB+55nRANb589Afy40W0UwkY91h39CiLweg1UU+W3ohLNvC2VurJ1htR6A3QaYPCjI7uvOvGGOlfv2XoSuBzEhmNfZXDqBrweUPVqUlWodneSG+6J1NTevThfDpEjmnsmzuuCPPfCvRvfcakT0S2Aeq9tYPr0ZryeBvOOlZBKUIEiCAVZwTgy41x6v6hm0LFZ4o7N7IuXPA+EDx+XjQ+tP/4lUrW2vCI1ydR0iYgmWdtu4yzG7bOiAdn8iYlA0iFJh1Z1JJv+ye2b3n1419XRH2riP0aqqlKClABIjUMW+rtSlw5qmCpgsynnl56/d+M/+P91wfUvQjDgTzx9h9AAAAAASUVORK5CYII=",remoteStorageIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2ZmNGEwNCIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZmY0YTA0IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",remoteStorageIconError:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2U5MDAwMCIgc3RvcC1vcGFjaXR5PSIuNzYwNzgiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZTkwMDAwIiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",remoteStorageIconOffline:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iIzY5Njk2OSIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjNjc2NzY3IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",syncIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDg3LjUgMTAwIiB4bWw6c3BhY2U9InByZXNlcnZlIiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTUuOTk5OTk5IDE2IiB3aWR0aD0iMTYiIHZlcnNpb249IjEuMSIgeT0iMHB4IiB4PSIwcHgiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01LjUxMTIgLTc2LjUyNSkiIGRpc3BsYXk9Im5vbmUiPgoJPHBhdGggZGlzcGxheT0iaW5saW5lIiBkPSJtNTEuNDczIDQyLjI1NS0yLjIwNSAyLjIxMmMxLjQ3OCAxLjQ3NyAyLjI5NSAzLjQ0MiAyLjI5NSA1LjUzMyAwIDQuMzA5LTMuNTA0IDcuODEyLTcuODEyIDcuODEydi0xLjU2MmwtMy4xMjUgMy4xMjUgMy4xMjQgMy4xMjV2LTEuNTYyYzYuMDI5IDAgMTAuOTM4LTQuOTA2IDEwLjkzOC0xMC45MzggMC0yLjkyNy0xLjE0MS01LjY3Ni0zLjIxNS03Ljc0NXoiLz4KCTxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0ibTQ2Ljg3NSA0MC42MjUtMy4xMjUtMy4xMjV2MS41NjJjLTYuMDMgMC0xMC45MzggNC45MDctMTAuOTM4IDEwLjkzOCAwIDIuOTI3IDEuMTQxIDUuNjc2IDMuMjE3IDcuNzQ1bDIuMjAzLTIuMjEyYy0xLjQ3Ny0xLjQ3OS0yLjI5NC0zLjQ0Mi0yLjI5NC01LjUzMyAwLTQuMzA5IDMuNTA0LTcuODEyIDcuODEyLTcuODEydjEuNTYybDMuMTI1LTMuMTI1eiIvPgo8L2c+CjxwYXRoIGZpbGw9IiNmZmYiIGQ9Im0xMCAwbC0wLjc1IDEuOTA2MmMtMS4wMDc4LTAuMjk0Mi0zLjQ1ODYtMC43NzA4LTUuNjU2MiAwLjkzNzYgMC0wLjAwMDItMy45MzAyIDIuNTk0MS0yLjA5MzggNy41OTQybDEuNjU2Mi0wLjcxOTJzLTEuNTM5OS0zLjExMjIgMS42ODc2LTUuNTMxM2MwIDAgMS42OTU3LTEuMTMzOSAzLjY4NzQtMC41OTM3bC0wLjcxODcgMS44MTI0IDMuODEyNS0xLjYyNS0xLjYyNS0zLjc4MTJ6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0ibTE0IDUuNTYyNWwtMS42NTYgMC43MTg3czEuNTQxIDMuMTEzNS0xLjY4OCA1LjUzMDhjMCAwLTEuNzI3MiAxLjEzNS0zLjcxODUgMC41OTRsMC43NS0xLjgxMi0zLjgxMjUgMS41OTQgMS41OTM4IDMuODEyIDAuNzgxMi0xLjkwNmMxLjAxMTMgMC4yOTUgMy40NjE1IDAuNzY2IDUuNjU2LTAuOTM4IDAgMCAzLjkyOC0yLjU5NCAyLjA5NC03LjU5MzV6Ii8+Cjwvc3ZnPgo=",widget:'<div class="rs-bubble rs-hidden">   <div class="rs-bubble-text remotestorage-initial remotestorage-error remotestorage-authing remotestorage-offline">     <span class="rs-status-text">{{view_connect}}</span>   </div>   <div class="rs-bubble-expandable">     <!-- error -->     <div class="remotestorage-error">       <pre class="rs-status-text rs-error-msg">{{ERROR_MSG}}</pre>       <button class="remotestorage-reset">{{view_get_me_out}}</button>       <p class="rs-centered-text rs-error-plz-report">{{view_error_plz_report}}</p>     </div>     <!-- connected -->     <div class="rs-bubble-text remotestorage-connected">       <strong class="userAddress">{{USER_ADDRESS}}</strong>       <p class="remotestorage-unauthorized">{{view_unauthorized}}</p>     </div>     <div class="rs-content remotestorage-connected">       <button class="rs-sync" title="sync"><img></button>       <button class="rs-disconnect" title="disconnect"><img></button>     </div>     <!-- initial -->     <form novalidate class="remotestorage-initial">       <input type="email" placeholder="user@host" name="userAddress" novalidate>       <button class="connect" name="connect" title="connect" disabled="disabled">         <img>       </button>     </form>     <div class="rs-info-msg remotestorage-initial">{{view_info}}</div>   </div> </div> <img class="rs-dropbox rs-backends rs-action" alt="Connect to Dropbox"> <img class="rs-googledrive rs-backends rs-action" alt="Connect to Google Drive"> <img class="rs-cube rs-action"> ',widgetCss:'/** encoding:utf-8 **/ /* RESET */ #remotestorage-widget{text-align:left;}#remotestorage-widget input, #remotestorage-widget button{font-size:11px;}#remotestorage-widget form input[type=email]{margin-bottom:0;/* HTML5 Boilerplate */}#remotestorage-widget form input[type=submit]{margin-top:0;/* HTML5 Boilerplate */}/* /RESET */ #remotestorage-widget, #remotestorage-widget *{-moz-box-sizing:border-box;box-sizing:border-box;}#remotestorage-widget{position:absolute;right:10px;top:10px;font:normal 16px/100% sans-serif !important;user-select:none;-webkit-user-select:none;-moz-user-select:-moz-none;cursor:default;z-index:10000;}#remotestorage-widget .rs-bubble{background:rgba(80, 80, 80, .7);border-radius:5px 15px 5px 5px;color:white;font-size:0.8em;padding:5px;position:absolute;right:3px;top:9px;min-height:24px;white-space:nowrap;text-decoration:none;}.rs-bubble .rs-bubble-text{padding-right:32px;/* make sure the bubble doesn\'t "jump" when initially opening. */ min-width:182px;}#remotestorage-widget .rs-action{cursor:pointer;}/* less obtrusive cube when connected */ #remotestorage-widget.remotestorage-state-connected .rs-cube, #remotestorage-widget.remotestorage-state-busy .rs-cube{opacity:.3;-webkit-transition:opacity .3s ease;-moz-transition:opacity .3s ease;-ms-transition:opacity .3s ease;-o-transition:opacity .3s ease;transition:opacity .3s ease;}#remotestorage-widget.remotestorage-state-connected:hover .rs-cube, #remotestorage-widget.remotestorage-state-busy:hover .rs-cube, #remotestorage-widget.remotestorage-state-connected .rs-bubble:not(.rs-hidden) + .rs-cube{opacity:1 !important;}#remotestorage-widget .rs-backends{position:relative;top:5px;right:0;}#remotestorage-widget .rs-cube{position:relative;top:5px;right:0;}/* pulsing animation for cube when loading */ #remotestorage-widget .rs-cube.remotestorage-loading{-webkit-animation:remotestorage-loading .5s ease-in-out infinite alternate;-moz-animation:remotestorage-loading .5s ease-in-out infinite alternate;-o-animation:remotestorage-loading .5s ease-in-out infinite alternate;-ms-animation:remotestorage-loading .5s ease-in-out infinite alternate;animation:remotestorage-loading .5s ease-in-out infinite alternate;}@-webkit-keyframes remotestorage-loading{to{opacity:.7}}@-moz-keyframes remotestorage-loading{to{opacity:.7}}@-o-keyframes remotestorage-loading{to{opacity:.7}}@-ms-keyframes remotestorage-loading{to{opacity:.7}}@keyframes remotestorage-loading{to{opacity:.7}}#remotestorage-widget a{text-decoration:underline;color:inherit;}#remotestorage-widget form{margin-top:.7em;position:relative;}#remotestorage-widget form input{display:table-cell;vertical-align:top;border:none;border-radius:6px;font-weight:bold;color:white;outline:none;line-height:1.5em;height:2em;}#remotestorage-widget form input:disabled{color:#999;background:#444 !important;cursor:default !important;}#remotestorage-widget form input[type=email]:focus{background:#223;}#remotestorage-widget form input[type=email]{background:#000;width:100%;height:26px;padding:0 30px 0 5px;border-top:1px solid #111;border-bottom:1px solid #999;}#remotestorage-widget form input[type=email]:focus{background:#223;}#remotestorage-widget button:focus, #remotestorage-widget input:focus{box-shadow:0 0 4px #ccc;}#remotestorage-widget form input[type=email]::-webkit-input-placeholder{color:#999;}#remotestorage-widget form input[type=email]:-moz-placeholder{color:#999;}#remotestorage-widget form input[type=email]::-moz-placeholder{color:#999;}#remotestorage-widget form input[type=email]:-ms-input-placeholder{color:#999;}#remotestorage-widget form input[type=submit]{background:#000;cursor:pointer;padding:0 5px;}#remotestorage-widget form input[type=submit]:hover{background:#333;}#remotestorage-widget .rs-info-msg{font-size:10px;color:#eee;margin-top:0.7em;white-space:normal;}#remotestorage-widget .rs-info-msg.last-synced-message{display:inline;white-space:nowrap;margin-bottom:.7em}#remotestorage-widget .rs-info-msg a:hover, #remotestorage-widget .rs-info-msg a:active{color:#fff;}#remotestorage-widget button img{vertical-align:baseline;}#remotestorage-widget button{border:none;border-radius:6px;font-weight:bold;color:white;outline:none;line-height:1.5em;height:26px;width:26px;background:#000;cursor:pointer;margin:0;padding:5px;}#remotestorage-widget button:hover{background:#333;}#remotestorage-widget .rs-bubble button.connect{display:block;background:none;position:absolute;right:0;top:0;opacity:1;/* increase clickable area of connect button */ margin:-5px;padding:10px;width:36px;height:36px;}#remotestorage-widget .rs-bubble button.connect:not([disabled]):hover{background:rgba(150,150,150,.5);}#remotestorage-widget .rs-bubble button.connect[disabled]{opacity:.5;cursor:default !important;}#remotestorage-widget .rs-bubble button.rs-sync{position:relative;left:-5px;bottom:-5px;padding:4px 4px 0 4px;background:#555;}#remotestorage-widget .rs-bubble button.rs-sync:hover{background:#444;}#remotestorage-widget .rs-bubble button.rs-disconnect{background:#721;position:absolute;right:0;bottom:0;padding:4px 4px 0 4px;}#remotestorage-widget .rs-bubble button.rs-disconnect:hover{background:#921;}#remotestorage-widget .remotestorage-error-info{color:#f92;}#remotestorage-widget .remotestorage-reset{width:100%;background:#721;}#remotestorage-widget .remotestorage-reset:hover{background:#921;}#remotestorage-widget .rs-bubble .rs-content{margin-top:7px;}#remotestorage-widget pre{user-select:initial;-webkit-user-select:initial;-moz-user-select:text;max-width:27em;margin-top:1em;overflow:auto;}#remotestorage-widget .rs-centered-text{text-align:center;}#remotestorage-widget .rs-bubble.rs-hidden{padding-bottom:2px;border-radius:5px 15px 15px 5px;}#remotestorage-widget .rs-error-msg{min-height:5em;}.rs-bubble.rs-hidden .rs-bubble-expandable{display:none;}.remotestorage-state-connected .rs-bubble.rs-hidden{display:none;}.remotestorage-connected{display:none;}.remotestorage-state-connected .remotestorage-connected{display:block;}.remotestorage-initial{display:none;}.remotestorage-state-initial .remotestorage-initial{display:block;}.remotestorage-error{display:none;}.remotestorage-state-error .remotestorage-error{display:block;}.remotestorage-state-authing .remotestorage-authing{display:block;}.remotestorage-state-offline .remotestorage-connected, .remotestorage-state-offline .remotestorage-offline{display:block;}.remotestorage-unauthorized{display:none;}.remotestorage-state-unauthorized .rs-bubble.rs-hidden{display:none;}.remotestorage-state-unauthorized .remotestorage-connected, .remotestorage-state-unauthorized .remotestorage-unauthorized{display:block;}.remotestorage-state-unauthorized .rs-sync{display:none;}.remotestorage-state-busy .rs-bubble.rs-hidden{display:none;}.remotestorage-state-busy .rs-bubble{display:block;}.remotestorage-state-busy .remotestorage-connected{display:block;}.remotestorage-state-authing .rs-bubble-expandable{display:none;}'},function(){function a(a,b){return RemoteStorage.log("[Widget] Producing stateSetter for",b),function(){RemoteStorage.log("[Widget] Setting state",b,arguments),d&&(localStorage[e]=b),a.view?(a.rs.remote&&a.view.setUserAddress(a.rs.remote.userAddress),a.view.setState(b,arguments)):a._rememberedState=b
}}function b(a){return function(b){b instanceof RemoteStorage.DiscoveryError?(console.error("Discovery failed",b,'"'+b.message+'"'),a.view.setState("initial",[b.message])):b instanceof RemoteStorage.SyncError?a.view.setState("offline",[]):b instanceof RemoteStorage.Unauthorized?a.view.setState("unauthorized"):(RemoteStorage.log("[Widget] Unknown error"),a.view.setState("error",[b]))}}function c(a){return"GET"===a.method&&a.isFolder?!1:!0}var d,e="remotestorage:widget:state",f={initial:!0,connected:!0,offline:!0};RemoteStorage.Widget=function(g){var h=this,i=0;if(this.rs=g,this.rs.remote.on("connected",a(this,"connected")),this.rs.on("disconnected",a(this,"initial")),this.rs.on("connecting",a(this,"authing")),this.rs.on("authing",a(this,"authing")),this.rs.on("error",b(this)),this.rs.remote&&(this.rs.remote.on("wire-busy",function(b){c(b)&&(i++,a(h,"busy")())}),this.rs.remote.on("wire-done",function(b){c(b)&&(i--,0>=i&&a(h,"connected")())})),d){var j=localStorage[e];j&&f[j]&&(this._rememberedState=j)}},RemoteStorage.Widget.prototype={display:function(){return this.view||this.setView(new RemoteStorage.Widget.View(this.rs)),this.view.display.apply(this.view,arguments),this},linkWidgetToSync:function(){"object"==typeof this.rs.sync&&"function"==typeof this.rs.sync.sync?this.view.on("sync",this.rs.sync.sync.bind(this.rs.sync)):(RemoteStorage.log("[Widget] typeof this.rs.sync check fail",this.rs.sync),setTimeout(this.linkWidgetToSync.bind(this),1e3))},setView:function(b){this.view=b,this.view.on("connect",function(a){"string"==typeof a?this.rs.connect(a):a.special&&this.rs[a.special].connect(a)}.bind(this)),this.view.on("disconnect",this.rs.disconnect.bind(this.rs)),this.linkWidgetToSync();try{this.view.on("reset",function(){var a=RemoteStorage.Authorize.getLocation();this.rs.on("disconnected",a.reload.bind(a)),this.rs.disconnect()}.bind(this))}catch(c){if(!c.message||!c.message.match(/Unknown event/))throw c}this._rememberedState&&(setTimeout(a(this,this._rememberedState),0),delete this._rememberedState)}},RemoteStorage.prototype.displayWidget=function(a){return this.widget.display(a)},RemoteStorage.Widget._rs_init=function(a){d=a.localStorageAvailable(),a.widget||(a.widget=new RemoteStorage.Widget(a))},RemoteStorage.Widget._rs_supported=function(){return"undefined"!=typeof document}}("undefined"!=typeof window?window:global),function(a){function b(a,b){return a.getElementsByClassName(b)[0]}function c(a,b){return a.getElementsByTagName(b)[0]}function d(a,b){return a.classList.remove(b)}function e(a,b){return a.classList.add(b)}function f(a){"function"==typeof a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function g(a,d,e,f){var g=b(a,d);if("undefined"!=typeof e){var h=c(g,"img");(h||g).src=RemoteStorage.Assets[e]}return g.addEventListener("click",f),g}var h=RemoteStorage.I18n.translate,i=function(){return document.createElement.apply(document,arguments)};RemoteStorage.Widget.View=function(a){if(this.rs=a,"undefined"==typeof document)throw"Widget not supported";RemoteStorage.eventHandling(this,"connect","disconnect","sync","display","reset");for(var b in this.events)this.events[b]=this.events[b].bind(this);this.hideBubbleOnBodyClick=function(a){for(var b=a.target;b!==document.body;b=b.parentElement)if("remotestorage-widget"===b.id)return;this.hideBubble()}.bind(this)},RemoteStorage.Widget.View.prototype={connectGdrive:function(){this._emit("connect",{special:"googledrive"})},connectDropbox:function(){this._emit("connect",{special:"dropbox"})},setState:function(a,b){RemoteStorage.log("[View] widget.view.setState(",a,",",b,");");var c=this.states[a];if("undefined"==typeof c)throw new Error("Bad State assigned to view: "+a);c.apply(this,b)},setUserAddress:function(a){this.userAddress=a||"";var b;this.div&&(b=c(this.div,"form").userAddress)&&(b.value=this.userAddress)},toggleBubble:function(a){this.bubble.className.search("rs-hidden")<0?this.hideBubble(a):this.showBubble(a)},hideBubble:function(){e(this.bubble,"rs-hidden"),document.body.removeEventListener("click",this.hideBubbleOnBodyClick)},showBubble:function(a){d(this.bubble,"rs-hidden"),"undefined"!=typeof a&&f(a),document.body.addEventListener("click",this.hideBubbleOnBodyClick),c(this.bubble,"form").userAddress.focus()},display:function(a){if("undefined"!=typeof this.div)return this.div;var b=i("div"),d=i("style");if(d.innerHTML=RemoteStorage.Assets.widgetCss,b.id="remotestorage-widget",b.innerHTML=RemoteStorage.Assets.widget,b.appendChild(d),a){var e=document.getElementById(a);if(!e)throw'Failed to find target DOM element with id="'+a+'"';e.appendChild(b)}else document.body.appendChild(b);g(b,"rs-sync","syncIcon",this.events.sync),g(b,"rs-disconnect","disconnectIcon",this.events.disconnect),g(b,"remotestorage-reset",void 0,this.events.reset);var f=g(b,"connect","connectIcon",this.events.connect);this.form=c(b,"form");var h=this.form.userAddress;h.addEventListener("keyup",function(a){a.target.value?f.removeAttribute("disabled"):f.setAttribute("disabled","disabled")}),this.userAddress&&(h.value=this.userAddress),this.cube=g(b,"rs-cube","remoteStorageIcon",this.toggleBubble.bind(this)),g(b,"rs-dropbox","dropbox",this.connectDropbox.bind(this)),g(b,"rs-googledrive","googledrive",this.connectGdrive.bind(this));var j={INPUT:!0,BUTTON:!0,IMG:!0},k=function(a){j[a.target.tagName]||this.div.classList.contains("remotestorage-state-unauthorized")||this.showBubble(a)}.bind(this);return this.bubble=g(b,"rs-bubble",void 0,k),this.hideBubble(),this.div=b,this.states.initial.call(this),this.events.display.call(this),this.div},_renderTranslatedInitialContent:function(){b(this.div,"rs-status-text").innerHTML=h("view_connect"),b(this.div,"remotestorage-reset").innerHTML=h("view_get_me_out"),b(this.div,"rs-error-plz-report").innerHTML=h("view_error_plz_report"),b(this.div,"remotestorage-unauthorized").innerHTML=h("view_unauthorized")},states:{initial:function(a){var c=this.cube,e=a||h("view_info");this._renderTranslatedInitialContent(),a?(c.src=RemoteStorage.Assets.remoteStorageIconError,d(this.cube,"remotestorage-loading"),this.showBubble(),setTimeout(function(){c.src=RemoteStorage.Assets.remoteStorageIcon},5e3)):this.hideBubble(),this.div.className="remotestorage-state-initial";var f=1;this._activateBackend("dropbox")&&(f+=1),this._activateBackend("googledrive")&&(f+=1),b(this.div,"rs-bubble-text").style.paddingRight=32*f+8+"px";var g=b(this.div,"connect");this.form.userAddress.value&&g.removeAttribute("disabled");var i=b(this.div,"rs-info-msg");i.innerHTML=e,a?i.classList.add("remotestorage-error-info"):i.classList.remove("remotestorage-error-info")},authing:function(){this.div.removeEventListener("click",this.events.connect),this.div.className="remotestorage-state-authing",b(this.div,"rs-status-text").innerHTML=h("view_connecting",this.userAddress),e(this.cube,"remotestorage-loading")},connected:function(){this.div.className="remotestorage-state-connected",b(this.div,"userAddress").innerHTML=this.userAddress,this.cube.src=RemoteStorage.Assets.remoteStorageIcon,d(this.cube,"remotestorage-loading");var a={googledrive:b(this.div,"rs-googledrive"),dropbox:b(this.div,"rs-dropbox")};a.googledrive.style.display=a.dropbox.style.display="none",a[this.rs.backend]?(a[this.rs.backend].style.display="inline-block",b(this.div,"rs-bubble-text").style.paddingRight="72px"):b(this.div,"rs-bubble-text").style.paddingRight="40px"},busy:function(){this.div.className="remotestorage-state-busy",e(this.cube,"remotestorage-loading"),this.hideBubble()},offline:function(){this.div.className="remotestorage-state-offline",this.cube.src=RemoteStorage.Assets.remoteStorageIconOffline,b(this.div,"rs-status-text").innerHTML=h("view_offline")},error:function(a){var c=a;this.div.className="remotestorage-state-error",b(this.div,"rs-bubble-text").innerHTML="<strong>"+h("view_error_occured")+"</strong>",a instanceof Error&&(c=a.message+"\n\n"+a.stack),b(this.div,"rs-error-msg").textContent=c,this.cube.src=RemoteStorage.Assets.remoteStorageIconError,this.showBubble()},unauthorized:function(){this.div.className="remotestorage-state-unauthorized",this.cube.src=RemoteStorage.Assets.remoteStorageIconError,this.showBubble(),this.div.addEventListener("click",this.events.connect)}},events:{connect:function(a){f(a),a.preventDefault(),this._emit("connect",c(this.div,"form").userAddress.value)},sync:function(a){f(a),a.preventDefault(),this._emit("sync")},disconnect:function(a){f(a),a.preventDefault(),this._emit("disconnect")},reset:function(b){b.preventDefault();var c=a.confirm(h("view_confirm_reset"));c&&this._emit("reset")},display:function(a){a&&a.preventDefault(),this._emit("display")}},_activateBackend:function(a){var c="rs-"+a;return this.rs.apiKeys[a]?(b(this.div,c).style.display="inline-block",!0):(b(this.div,c).style.display="none",!1)}}}("undefined"!=typeof window?window:global),function(a){function b(a,c){if(a===c)return!0;if("object"==typeof a&&"object"==typeof c){if(Array.isArray(a)!=Array.isArray(c))return!1;if(Array.isArray(a)){if(a.length!=c.length)return!1;for(var d=0;d<a.length;d++)if(!b(a[d],c[d]))return!1}else{for(var e in a)if(void 0===c[e]&&void 0!==a[e])return!1;for(var e in c)if(void 0===a[e]&&void 0!==c[e])return!1;for(var e in a)if(!b(a[e],c[e]))return!1}return!0}return!1}function c(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function d(a,b){function d(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return b=c(b||""),a=c(a||""),b&&a?(b.protocol||a.protocol)+(b.protocol||b.authority?b.authority:a.authority)+d(b.protocol||b.authority||"/"===b.pathname.charAt(0)?b.pathname:b.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+b.pathname:a.pathname)+(b.protocol||b.authority||b.pathname?b.search:b.search||a.search)+b.hash:null}function e(a,b){if(void 0==b?b=a.id:"string"==typeof a.id&&(b=d(b,a.id),a.id=b),"object"==typeof a)if(Array.isArray(a))for(var c=0;c<a.length;c++)e(a[c],b);else if("string"==typeof a.$ref)a.$ref=d(b,a.$ref);else for(var f in a)"enum"!=f&&e(a[f],b)}function f(a,b,c,d,e){if(void 0==a)throw new Error("No code supplied for error: "+b);this.code=a,this.message=b,this.dataPath=c?c:"",this.schemaPath=d?d:"",this.subErrors=e?e:null}function g(a,b,c){if("string"==typeof b.id&&b.id.substring(0,c.length)==c){var d=b.id.substring(c.length);(c.length>0&&"/"==c.charAt(c.length-1)||"#"==d.charAt(0)||"?"==d.charAt(0))&&void 0==a[b.id]&&(a[b.id]=b)}if("object"==typeof b)for(var e in b)"enum"!=e&&"object"==typeof b[e]&&g(a,b[e],c);return a}var h=function(a,b){this.missing=[],this.schemas=a?Object.create(a.schemas):{},this.collectMultiple=b,this.errors=[],this.handleError=b?this.collectError:this.returnError};h.prototype.returnError=function(a){return a},h.prototype.collectError=function(a){return a&&this.errors.push(a),null},h.prototype.prefixErrors=function(a,b,c){for(var d=a;d<this.errors.length;d++)this.errors[d]=this.errors[d].prefixWith(b,c);return this},h.prototype.getSchema=function(a){if(void 0!=this.schemas[a]){var b=this.schemas[a];return b}var c=a,d="";if(-1!=a.indexOf("#")&&(d=a.substring(a.indexOf("#")+1),c=a.substring(0,a.indexOf("#"))),void 0!=this.schemas[c]){var b=this.schemas[c],e=decodeURIComponent(d);if(""==e)return b;if("/"!=e.charAt(0))return void 0;for(var f=e.split("/").slice(1),g=0;g<f.length;g++){var h=f[g].replace("~1","/").replace("~0","~");if(void 0==b[h]){b=void 0;break}b=b[h]}if(void 0!=b)return b}void 0==this.missing[c]&&(this.missing.push(c),this.missing[c]=c)},h.prototype.addSchema=function(a,b){var c={};c[a]=b,e(b,a),g(c,b,a);for(var d in c)this.schemas[d]=c[d];return c},h.prototype.validateAll=function(a,b,c,d){if(void 0!=b.$ref&&(b=this.getSchema(b.$ref),!b))return null;var e=this.errors.length,f=this.validateBasic(a,b)||this.validateNumeric(a,b)||this.validateString(a,b)||this.validateArray(a,b)||this.validateObject(a,b)||this.validateCombinations(a,b)||null;if(f||e!=this.errors.length)for(;c&&c.length||d&&d.length;){var g=c&&c.length?""+c.pop():null,h=d&&d.length?""+d.pop():null;f&&(f=f.prefixWith(g,h)),this.prefixErrors(e,g,h)}return this.handleError(f)},h.prototype.validateBasic=function(a,b){var c;return(c=this.validateType(a,b))?c.prefixWith(null,"type"):(c=this.validateEnum(a,b))?c.prefixWith(null,"type"):null},h.prototype.validateType=function(a,b){if(void 0==b.type)return null;var c=typeof a;null==a?c="null":Array.isArray(a)&&(c="array");var d=b.type;"object"!=typeof d&&(d=[d]);for(var e=0;e<d.length;e++){var g=d[e];if(g==c||"integer"==g&&"number"==c&&a%1==0)return null}return new f(i.INVALID_TYPE,"invalid data type: "+c)},h.prototype.validateEnum=function(a,c){if(void 0==c["enum"])return null;for(var d=0;d<c["enum"].length;d++){var e=c["enum"][d];if(b(a,e))return null}return new f(i.ENUM_MISMATCH,"No enum match for: "+JSON.stringify(a))},h.prototype.validateNumeric=function(a,b){return this.validateMultipleOf(a,b)||this.validateMinMax(a,b)||null},h.prototype.validateMultipleOf=function(a,b){var c=b.multipleOf||b.divisibleBy;return void 0==c?null:"number"==typeof a&&a%c!=0?new f(i.NUMBER_MULTIPLE_OF,"Value "+a+" is not a multiple of "+c):null},h.prototype.validateMinMax=function(a,b){if("number"!=typeof a)return null;if(void 0!=b.minimum){if(a<b.minimum)return new f(i.NUMBER_MINIMUM,"Value "+a+" is less than minimum "+b.minimum).prefixWith(null,"minimum");if(b.exclusiveMinimum&&a==b.minimum)return new f(i.NUMBER_MINIMUM_EXCLUSIVE,"Value "+a+" is equal to exclusive minimum "+b.minimum).prefixWith(null,"exclusiveMinimum")}if(void 0!=b.maximum){if(a>b.maximum)return new f(i.NUMBER_MAXIMUM,"Value "+a+" is greater than maximum "+b.maximum).prefixWith(null,"maximum");if(b.exclusiveMaximum&&a==b.maximum)return new f(i.NUMBER_MAXIMUM_EXCLUSIVE,"Value "+a+" is equal to exclusive maximum "+b.maximum).prefixWith(null,"exclusiveMaximum")}return null},h.prototype.validateString=function(a,b){return this.validateStringLength(a,b)||this.validateStringPattern(a,b)||null},h.prototype.validateStringLength=function(a,b){return"string"!=typeof a?null:void 0!=b.minLength&&a.length<b.minLength?new f(i.STRING_LENGTH_SHORT,"String is too short ("+a.length+" chars), minimum "+b.minLength).prefixWith(null,"minLength"):void 0!=b.maxLength&&a.length>b.maxLength?new f(i.STRING_LENGTH_LONG,"String is too long ("+a.length+" chars), maximum "+b.maxLength).prefixWith(null,"maxLength"):null},h.prototype.validateStringPattern=function(a,b){if("string"!=typeof a||void 0==b.pattern)return null;var c=new RegExp(b.pattern);return c.test(a)?null:new f(i.STRING_PATTERN,"String does not match pattern").prefixWith(null,"pattern")},h.prototype.validateArray=function(a,b){return Array.isArray(a)?this.validateArrayLength(a,b)||this.validateArrayUniqueItems(a,b)||this.validateArrayItems(a,b)||null:null},h.prototype.validateArrayLength=function(a,b){if(void 0!=b.minItems&&a.length<b.minItems){var c=new f(i.ARRAY_LENGTH_SHORT,"Array is too short ("+a.length+"), minimum "+b.minItems).prefixWith(null,"minItems");if(this.handleError(c))return c}if(void 0!=b.maxItems&&a.length>b.maxItems){var c=new f(i.ARRAY_LENGTH_LONG,"Array is too long ("+a.length+" chars), maximum "+b.maxItems).prefixWith(null,"maxItems");if(this.handleError(c))return c}return null},h.prototype.validateArrayUniqueItems=function(a,c){if(c.uniqueItems)for(var d=0;d<a.length;d++)for(var e=d+1;e<a.length;e++)if(b(a[d],a[e])){var g=new f(i.ARRAY_UNIQUE,"Array items are not unique (indices "+d+" and "+e+")").prefixWith(null,"uniqueItems");if(this.handleError(g))return g}return null},h.prototype.validateArrayItems=function(a,b){if(void 0==b.items)return null;var c;if(Array.isArray(b.items)){for(var d=0;d<a.length;d++)if(d<b.items.length){if(c=this.validateAll(a[d],b.items[d],[d],["items",d]))return c}else if(void 0!=b.additionalItems)if("boolean"==typeof b.additionalItems){if(!b.additionalItems&&(c=new f(i.ARRAY_ADDITIONAL_ITEMS,"Additional items not allowed").prefixWith(""+d,"additionalItems"),this.handleError(c)))return c}else if(c=this.validateAll(a[d],b.additionalItems,[d],["additionalItems"]))return c}else for(var d=0;d<a.length;d++)if(c=this.validateAll(a[d],b.items,[d],["items"]))return c;return null},h.prototype.validateObject=function(a,b){return"object"!=typeof a||null==a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,b)||this.validateObjectRequiredProperties(a,b)||this.validateObjectProperties(a,b)||this.validateObjectDependencies(a,b)||null},h.prototype.validateObjectMinMaxProperties=function(a,b){var c=Object.keys(a);if(void 0!=b.minProperties&&c.length<b.minProperties){var d=new f(i.OBJECT_PROPERTIES_MINIMUM,"Too few properties defined ("+c.length+"), minimum "+b.minProperties).prefixWith(null,"minProperties");if(this.handleError(d))return d}if(void 0!=b.maxProperties&&c.length>b.maxProperties){var d=new f(i.OBJECT_PROPERTIES_MAXIMUM,"Too many properties defined ("+c.length+"), maximum "+b.maxProperties).prefixWith(null,"maxProperties");if(this.handleError(d))return d}return null},h.prototype.validateObjectRequiredProperties=function(a,b){if(void 0!=b.required)for(var c=0;c<b.required.length;c++){var d=b.required[c];if(void 0===a[d]){var e=new f(i.OBJECT_REQUIRED,"Missing required property: "+d).prefixWith(null,""+c).prefixWith(null,"required");if(this.handleError(e))return e}}return null},h.prototype.validateObjectProperties=function(a,b){var c;for(var d in a){var e=!1;if(void 0!=b.properties&&void 0!=b.properties[d]&&(e=!0,c=this.validateAll(a[d],b.properties[d],[d],["properties",d])))return c;if(void 0!=b.patternProperties)for(var g in b.patternProperties){var h=new RegExp(g);if(h.test(d)&&(e=!0,c=this.validateAll(a[d],b.patternProperties[g],[d],["patternProperties",g])))return c}if(!e&&void 0!=b.additionalProperties)if("boolean"==typeof b.additionalProperties){if(!b.additionalProperties&&(c=new f(i.OBJECT_ADDITIONAL_PROPERTIES,"Additional properties not allowed").prefixWith(d,"additionalProperties"),this.handleError(c)))return c}else if(c=this.validateAll(a[d],b.additionalProperties,[d],["additionalProperties"]))return c}return null},h.prototype.validateObjectDependencies=function(a,b){var c;if(void 0!=b.dependencies)for(var d in b.dependencies)if(void 0!==a[d]){var e=b.dependencies[d];if("string"==typeof e){if(void 0===a[e]&&(c=new f(i.OBJECT_DEPENDENCY_KEY,"Dependency failed - key must exist: "+e).prefixWith(null,d).prefixWith(null,"dependencies"),this.handleError(c)))return c}else if(Array.isArray(e))for(var g=0;g<e.length;g++){var h=e[g];if(void 0===a[h]&&(c=new f(i.OBJECT_DEPENDENCY_KEY,"Dependency failed - key must exist: "+h).prefixWith(null,""+g).prefixWith(null,d).prefixWith(null,"dependencies"),this.handleError(c)))return c}else if(c=this.validateAll(a,e,[],["dependencies",d]))return c}return null},h.prototype.validateCombinations=function(a,b){return this.validateAllOf(a,b)||this.validateAnyOf(a,b)||this.validateOneOf(a,b)||this.validateNot(a,b)||null},h.prototype.validateAllOf=function(a,b){if(void 0==b.allOf)return null;for(var c,d=0;d<b.allOf.length;d++){var e=b.allOf[d];if(c=this.validateAll(a,e,[],["allOf",d]))return c}return null},h.prototype.validateAnyOf=function(a,b){if(void 0==b.anyOf)return null;for(var c=[],d=this.errors.length,e=0;e<b.anyOf.length;e++){var g=b.anyOf[e],h=this.errors.length,j=this.validateAll(a,g,[],["anyOf",e]);if(null==j&&h==this.errors.length)return this.errors=this.errors.slice(0,d),null;j&&c.push(j.prefixWith(null,""+e).prefixWith(null,"anyOf"))}return c=c.concat(this.errors.slice(d)),this.errors=this.errors.slice(0,d),new f(i.ANY_OF_MISSING,'Data does not match any schemas from "anyOf"',"","/anyOf",c)},h.prototype.validateOneOf=function(a,b){if(void 0==b.oneOf)return null;for(var c=null,d=[],e=this.errors.length,g=0;g<b.oneOf.length;g++){var h=b.oneOf[g],j=this.errors.length,k=this.validateAll(a,h,[],["oneOf",g]);if(null==k&&j==this.errors.length){if(null!=c)return this.errors=this.errors.slice(0,e),new f(i.ONE_OF_MULTIPLE,'Data is valid against more than one schema from "oneOf": indices '+c+" and "+g,"","/oneOf");c=g}else k&&d.push(k.prefixWith(null,""+g).prefixWith(null,"oneOf"))}return null==c?(d=d.concat(this.errors.slice(e)),this.errors=this.errors.slice(0,e),new f(i.ONE_OF_MISSING,'Data does not match any schemas from "oneOf"',"","/oneOf",d)):(this.errors=this.errors.slice(0,e),null)},h.prototype.validateNot=function(a,b){if(void 0==b.not)return null;var c=this.errors.length,d=this.validateAll(a,b.not),e=this.errors.slice(c);return this.errors=this.errors.slice(0,c),null==d&&0==e.length?new f(i.NOT_PASSED,'Data matches schema from "not"',"","/not"):null};var i={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403};f.prototype={prefixWith:function(a,b){if(null!=a&&(a=a.replace("~","~0").replace("/","~1"),this.dataPath="/"+a+this.dataPath),null!=b&&(b=b.replace("~","~0").replace("/","~1"),this.schemaPath="/"+b+this.schemaPath),null!=this.subErrors)for(var c=0;c<this.subErrors.length;c++)this.subErrors[c].prefixWith(a,b);return this}};var j=new h,k={validate:function(a,b){var c=new h(j);"string"==typeof b&&(b={$ref:b});var d=(c.addSchema("",b),c.validateAll(a,b));return this.error=d,this.missing=c.missing,this.valid=null==d,this.valid},validateResult:function(){var a={};return this.validate.apply(a,arguments),a},validateMultiple:function(a,b){var c=new h(j,!0);"string"==typeof b&&(b={$ref:b}),c.addSchema("",b),c.validateAll(a,b);var d={};return d.errors=c.errors,d.missing=c.missing,d.valid=0==d.errors.length,d},addSchema:function(a,b){return j.addSchema(a,b)},getSchema:function(a){return j.getSchema(a)},missing:[],error:null,normSchema:e,resolveUrl:d,errorCodes:i};a.tv4=k}("undefined"!=typeof window?window:global);var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(a,b){var c,d=CHARS,e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("")},function(){function a(a,b){console.log("WARNING: "+a+" is deprecated. Use "+b+" instead.")}var b=RemoteStorage;b.BaseClient=function(a,c){if("/"!==c[c.length-1])throw"Not a folder: "+c;"/"===c&&(this.makePath=function(a){return("/"===a[0]?"":"/")+a}),this.storage=a,this.base=c;var d=this.base.split("/");this.moduleName=d.length>2?d[1]:"root",b.eventHandling(this,"change"),this.on=this.on.bind(this),a.onChange(this.base,this._fireChange.bind(this))},b.BaseClient.prototype={extend:function(a){for(var b in a)this[b]=a[b];return this},scope:function(a){return new b.BaseClient(this.storage,this.makePath(a))},getListing:function(a,b){if("string"!=typeof a)a="";else if(a.length>0&&"/"!==a[a.length-1])throw"Not a folder: "+a;return maxAgeInvalid(b)?promising().reject("Argument 'maxAge' of baseClient.getListing must be undefined or a number"):this.storage.get(this.makePath(a),b).then(function(a,b){return 404===a?void 0:b})},getAll:function(a,b){if("string"!=typeof a)a="";else if(a.length>0&&"/"!==a[a.length-1])throw"Not a folder: "+a;return maxAgeInvalid(b)?promising().reject("Argument 'maxAge' of baseClient.getAll must be undefined or a number"):this.storage.get(this.makePath(a),b).then(function(c,d){if(404!==c&&"object"==typeof d){var e=promising(),f=Object.keys(d).length,g=0;if(0===f)return;for(var h in d)this.storage.get(this.makePath(a+h),b).then(function(a,b){d[this.key]=b,g++,g===f&&e.fulfill(d)}.bind({key:h}));return e}}.bind(this))},getFile:function(a,b){return"string"!=typeof a?promising().reject("Argument 'path' of baseClient.getFile must be a string"):maxAgeInvalid(b)?promising().reject("Argument 'maxAge' of baseClient.getFile must be undefined or a number"):this.storage.get(this.makePath(a),b).then(function(a,b,c,d){return{data:b,mimeType:c,revision:d}})},storeFile:function(a,b,c){if("string"!=typeof a)return promising().reject("Argument 'mimeType' of baseClient.storeFile must be a string");if("string"!=typeof b)return promising().reject("Argument 'path' of baseClient.storeFile must be a string");if("string"!=typeof c&&"object"!=typeof c)return promising().reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView");var d=this;return this.storage.put(this.makePath(b),c,a).then(function(a,c,e,f){if(200===a||201===a)return f;throw"Request (PUT "+d.makePath(b)+") failed with status: "+a})},getObject:function(a,b){return"string"!=typeof a?promising().reject("Argument 'path' of baseClient.getObject must be a string"):maxAgeInvalid(b)?promising().reject("Argument 'maxAge' of baseClient.getObject must be undefined or a number"):this.storage.get(this.makePath(a),b).then(function(b,c){if("object"==typeof c)return c;if("undefined"!=typeof c&&200===b)throw"Not an object: "+this.makePath(a)})},storeObject:function(a,c,d){if("string"!=typeof a)return promising().reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if("string"!=typeof c)return promising().reject("Argument 'path' of baseClient.storeObject must be a string");if("object"!=typeof d)return promising().reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(d,a);try{var e=this.validate(d);if(!e.valid)return promising(function(a){a.reject(e)})}catch(f){if(!(f instanceof b.BaseClient.Types.SchemaNotFound))return promising().reject(f)}return this.storage.put(this.makePath(c),d,"application/json; charset=UTF-8").then(function(a,b,d,e){if(200===a||201===a)return e;throw"Request (PUT "+this.makePath(c)+") failed with status: "+a}.bind(this))},remove:function(a){return"string"!=typeof a?promising().reject("Argument 'path' of baseClient.remove must be a string"):this.storage.delete(this.makePath(a))},cache:function(b,c){if("string"!=typeof b)throw"Argument 'path' of baseClient.cache must be a string";if(c===!1?(a("caching strategy <false>",'<"FLUSH">'),c="FLUSH"):void 0===c?c="ALL":"string"!=typeof c&&(a("that caching strategy",'<"ALL">'),c="ALL"),"FLUSH"!==c&&"SEEN"!==c&&"ALL"!==c)throw'Argument \'strategy\' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]';return this.storage.caching.set(this.makePath(b),c),this},flush:function(a){return this.storage.local.flush(a)},makePath:function(a){return this.base+(a||"")},_fireChange:function(a){this._emit("change",a)},_cleanPath:b.WireClient.cleanPath,getItemURL:function(a){if("string"!=typeof a)throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(a=this._cleanPath(this.makePath(a)),this.storage.remote.href+a):void 0},uuid:function(){return Math.uuid()}},b.BaseClient._rs_init=function(){b.prototype.scope=function(a){if("string"!=typeof a)throw"Argument 'path' of baseClient.scope must be a string";return new b.BaseClient(this,a)}},maxAgeInvalid=function(a){return"undefined"!=typeof a&&"number"!=typeof a}}("undefined"!=typeof window?window:global),function(){RemoteStorage.BaseClient.Types={uris:{},schemas:{},aliases:{},declare:function(a,b,c,d){var e=a+"/"+b;if(d.extends){var f,g=d.extends.split("/");f=1===g.length?a+"/"+g.shift():g.join("/");var h=this.uris[f];if(!h)throw"Type '"+e+"' tries to extend unknown schema '"+f+"'";d.extends=this.schemas[h]}this.uris[e]=c,this.aliases[c]=e,this.schemas[c]=d},resolveAlias:function(a){return this.uris[a]},getSchema:function(a){return this.schemas[a]},inScope:function(a){var b=a.length,c={};for(var d in this.uris)if(d.substr(0,b+1)===a+"/"){var e=this.uris[d];c[e]=this.schemas[e]}return c}};var a=function(a){var b=new Error("Schema not found: "+a);return b.name="SchemaNotFound",b};a.prototype=Error.prototype,RemoteStorage.BaseClient.Types.SchemaNotFound=a,RemoteStorage.BaseClient.prototype.extend({validate:function(b){var c=RemoteStorage.BaseClient.Types.getSchema(b["@context"]);if(c)return tv4.validateResult(b,c);throw new a(b["@context"])},declareType:function(a,b,c){c||(c=b,b=this._defaultTypeURI(a)),RemoteStorage.BaseClient.Types.declare(this.moduleName,a,b,c)},_defaultTypeURI:function(a){return"http://remotestoragejs.com/spec/modules/"+this.moduleName+"/"+a},_attachType:function(a,b){a["@context"]=RemoteStorage.BaseClient.Types.resolveAlias(b)||this._defaultTypeURI(b)}}),Object.defineProperty(RemoteStorage.BaseClient.prototype,"schemas",{configurable:!0,get:function(){return RemoteStorage.BaseClient.Types.inScope(this.moduleName)}})}("undefined"!=typeof window?window:global),function(){function a(a){if(""===a)return"/";if(!a)throw"Path not given!";return a.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")}RemoteStorage.Caching=function(){this.reset()},RemoteStorage.Caching.prototype={pendingActivations:[],set:function(a,b){if("string"!=typeof a)throw new Error("path should be a string");if("undefined"==typeof b)throw new Error("value should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[a]=b,"ALL"===b&&(this.activateHandler?this.activateHandler(a):this.pendingActivations.push(a))},enable:function(a){this.set(a,"ALL")},disable:function(a){this.set(a,"FLUSH")},onActivate:function(a){var b;for(RemoteStorage.log("[Caching] Setting activate handler",a,this.pendingActivations),this.activateHandler=a,b=0;b<this.pendingActivations.length;b++)a(this.pendingActivations[b]);delete this.pendingActivations},checkPath:function(b){return void 0!==this._rootPaths[b]?this._rootPaths[b]:"/"===b?"SEEN":this.checkPath(a(b))},reset:function(){this._rootPaths={}}},Object.defineProperty(RemoteStorage.prototype,"caching",{configurable:!0,get:function(){var a=new RemoteStorage.Caching;return Object.defineProperty(this,"caching",{value:a}),a}}),RemoteStorage.Caching._rs_init=function(){}}("undefined"!=typeof window?window:global),function(){function a(a,b,c){return{action:a,path:b,promise:c}}function b(a){return a.remote&&a.remote.revision&&!a.remote.itemsMap&&!a.remote.body}function c(a){return a.common&&a.common.revision}function d(a,b){return JSON.stringify(a)===JSON.stringify(b)}function e(a){return"/"===a.substr(-1)}var f=1e4;RemoteStorage.Sync=function(a,b,c,d){this.local=a,this.local.onDiff(function(a){this.addTask(a),this.doTasks()}.bind(this)),this.remote=b,this.access=c,this.caching=d,this._tasks={},this._running={},this._timeStarted={},RemoteStorage.eventHandling(this,"done","req-done"),this.caching.onActivate(function(a){this.addTask(a),this.doTasks()}.bind(this))},RemoteStorage.Sync.prototype={now:function(){return(new Date).getTime()},queueGetRequest:function(a,b){this.remote.connected?this.remote.online?(this.addTask(a,function(){this.local.get(a).then(function(a,c,d){b.fulfill(a,c,d)})}.bind(this)),this.doTasks()):b.reject("cannot fulfill maxAge requirement - remote is not online"):b.reject("cannot fulfill maxAge requirement - remote is not connected")},corruptServerItemsMap:function(a,b){if("object"!=typeof a||Array.isArray(a))return!0;for(var c in a){var d=a[c];if("object"!=typeof d)return!0;if("string"!=typeof d.ETag)return!0;if(e(c)){if(-1!==c.substring(0,c.length-1).indexOf("/"))return!0}else{if(-1!==c.indexOf("/"))return!0;if(b){if("string"!=typeof d["Content-Type"])return!0;if("number"!=typeof d["Content-Length"])return!0}}}return!1},corruptItemsMap:function(a){if("object"!=typeof a||Array.isArray(a))return!0;
for(var b in a)if("boolean"!=typeof a[b])return!0;return!1},corruptRevision:function(a){return"object"!=typeof a||Array.isArray(a)||a.revision&&"string"!=typeof a.revision||a.body&&"string"!=typeof a.body&&"object"!=typeof a.body||a.contentType&&"string"!=typeof a.contentType||a.contentLength&&"number"!=typeof a.contentLength||a.timestamp&&"number"!=typeof a.timestamp||a.itemsMap&&this.corruptItemsMap(a.itemsMap)},isCorrupt:function(a){return"object"!=typeof a||Array.isArray(a)||"string"!=typeof a.path||this.corruptRevision(a.common)||a.local&&this.corruptRevision(a.local)||a.remote&&this.corruptRevision(a.remote)||a.push&&this.corruptRevision(a.push)},isFolderNode:function(a){return"/"===a.path.substr(-1)},isDocumentNode:function(a){return!this.isFolderNode(a)},hasTasks:function(){return Object.getOwnPropertyNames(this._tasks).length>0},collectDiffTasks:function(){var a=0;return this.local.forAllNodes(function(b){a>100||(this.isCorrupt(b)?(RemoteStorage.log("[Sync] WARNING: corrupt node in local cache",b),"object"==typeof b&&b.path&&(this.addTask(b.path),a++)):this.needsFetch(b)&&this.access.checkPathPermission(b.path,"r")?(this.addTask(b.path),a++):this.isDocumentNode(b)&&this.needsPush(b)&&this.access.checkPathPermission(b.path,"rw")&&(this.addTask(b.path),a++))}.bind(this)).then(function(){return a},function(a){throw a})},inConflict:function(a){return a.local&&a.remote&&(void 0!==a.remote.body||a.remote.itemsMap)},needsRefresh:function(a){return a.common?a.common.timestamp?this.now()-a.common.timestamp>f:!0:!1},needsFetch:function(a){return this.inConflict(a)?!0:a.common&&void 0===a.common.itemsMap&&void 0===a.common.body?!0:a.remote&&void 0===a.remote.itemsMap&&void 0===a.remote.body?!0:void 0},needsPush:function(a){return this.inConflict(a)?!1:a.local&&!a.push?!0:void 0},needsRemotePut:function(a){return a.local&&a.local.body},needsRemoteDelete:function(a){return a.local&&a.local.body===!1},getParentPath:function(a){var b=a.match(/^(.*\/)([^\/]+\/?)$/);if(b)return b[1];throw new Error('Not a valid path: "'+a+'"')},deleteChildPathsFromTasks:function(){for(var a in this._tasks){paths=this.local._getInternals().pathsFromRoot(a);for(var b=1;b<paths.length;b++)this._tasks[paths[b]]&&delete this._tasks[a]}},collectRefreshTasks:function(){return this.local.forAllNodes(function(a){var b;if(this.needsRefresh(a)){try{b=this.getParentPath(a.path)}catch(c){}b&&this.access.checkPathPermission(b,"r")?this.addTask(b):this.access.checkPathPermission(a.path,"r")&&this.addTask(a.path)}}.bind(this)).then(function(){this.deleteChildPathsFromTasks()}.bind(this),function(a){throw a})},flush:function(a){for(var b in a)"FLUSH"!==this.caching.checkPath(b)||a[b].local||(RemoteStorage.log("[Sync] Flushing",b),a[b]=void 0);return a},doTask:function(d){var e=this.local.getNodes([d]).then(function(e){var f=e[d];return"undefined"==typeof f?a("get",d,this.remote.get(d)):b(f)?a("get",d,this.remote.get(d)):this.needsRemotePut(f)?(f.push=this.local._getInternals().deepClone(f.local),f.push.timestamp=this.now(),this.local.setNodes(this.flush(e)).then(function(){var b;return b=c(f)?{ifMatch:f.common.revision}:{ifNoneMatch:"*"},a("put",d,this.remote.put(d,f.push.body,f.push.contentType,b))}.bind(this))):this.needsRemoteDelete(f)?(f.push={body:!1,timestamp:this.now()},this.local.setNodes(this.flush(e)).then(function(){return c(f)?a("delete",d,this.remote.delete(d,{ifMatch:f.common.revision})):a("get",d,this.remote.get(d))}.bind(this))):c(f)?a("get",d,this.remote.get(d,{ifNoneMatch:f.common.revision})):a("get",d,this.remote.get(d))}.bind(this));return e},autoMergeFolder:function(a){if(a.remote.itemsMap&&(a.common=a.remote,delete a.remote,a.common.itemsMap))for(var b in a.common.itemsMap)a.local.itemsMap[b]||(a.local.itemsMap[b]=!1);return a},autoMergeDocument:function(a){return void 0!==a.remote.body&&(RemoteStorage.log("[Sync] Emitting keep/revert"),this.local._emit("change",{origin:"conflict",path:a.path,oldValue:a.local.body,newValue:a.remote.body,oldContentType:a.local.contentType,newContentType:a.remote.contentType}),a.common=a.remote,delete a.remote,delete a.local),delete a.push,a},autoMerge:function(a){return a.remote?a.local?e(a.path)?this.autoMergeFolder(a):this.autoMergeDocument(a):(e(a.path)?void 0!==a.remote.itemsMap&&(a.common=a.remote,delete a.remote):void 0!==a.remote.body&&(this.local._emit("change",{origin:"remote",path:a.path,oldValue:a.common.body===!1?void 0:a.common.body,newValue:a.remote.body===!1?void 0:a.remote.body}),a.common=a.remote,delete a.remote),a):void this.local._emit("change",{origin:"remote",path:a.path,oldValue:a.common.body===!1?void 0:a.common.body,newValue:void 0})},markChildren:function(a,b,c,d){var f=[],g={},h={};for(var i in b)f.push(a+i),g[a+i]=b[i];for(var j in d)f.push(a+j);return this.local.getNodes(f).then(function(b){var f,i;nodeChanged=function(a,b){return a.common.revision!==b&&(!a.remote||a.remote.revision!==b)};for(var j in b)if(i=b[j],g[j])i&&i.common?nodeChanged(i,g[j].ETag)&&(c[j]=this.local._getInternals().deepClone(i),c[j].remote={revision:g[j].ETag,timestamp:this.now()},c[j]=this.autoMerge(c[j])):(f=this.caching.checkPath(j),"ALL"===f&&(c[j]={path:j,common:{timestamp:this.now()},remote:{revision:g[j].ETag,timestamp:this.now()}})),c[j]&&g[j]["Content-Type"]&&(c[j].remote.contentType=g[j]["Content-Type"]),c[j]&&g[j]["Content-Length"]&&(c[j].remote.contentLength=g[j]["Content-Length"]);else if(d[j.substring(a.length)]&&i&&i.common){if(i.common.itemsMap)for(var k in i.common.itemsMap)h[j+k]=!0;if(i.local&&i.local.itemsMap)for(var l in i.local.itemsMap)h[j+l]=!0;c[j]=i.remote||e(j)?void 0:this.autoMerge(i)}return this.deleteRemoteTrees(Object.keys(h),c).then(function(a){return this.local.setNodes(this.flush(a))}.bind(this))}.bind(this))},deleteRemoteTrees:function(a,b){return 0===a.length?promising().fulfill(b):void this.local.getNodes(a).then(function(a){var c={};collectSubPaths=function(a,b){if(a&&a.itemsMap)for(var d in a.itemsMap)c[b+d]=!0};for(var d in a){var f=a[d];f&&(e(d)?(collectSubPaths(f.common,d),collectSubPaths(f.local,d)):f.common&&void 0!==typeof f.common.body&&(b[d]=this.local._getInternals().deepClone(f),b[d].remote={body:!1,timestamp:this.now()},b[d]=this.autoMerge(b[d])))}return this.deleteRemoteTrees(Object.keys(c),b).then(function(a){return this.local.setNodes(this.flush(a))}.bind(this))}.bind(this))},completeFetch:function(a,b,c,d){var f=this.local.getNodes([a]).then(function(f){var g,h={},i=f[a];if(collectMissingChildren=function(a){if(a&&a.itemsMap)for(var c in a.itemsMap)b[c]||(h[c]=!0)},("object"!=typeof i||i.path!==a||"object"!=typeof i.common)&&(i={path:a,common:{}},f[a]=i),i.remote={revision:d,timestamp:this.now()},e(a)){collectMissingChildren(i.common),collectMissingChildren(i.remote),i.remote.itemsMap={};for(g in b)i.remote.itemsMap[g]=!0}else i.remote.body=b,i.remote.contentType=c;return f[a]=this.autoMerge(i),{toBeSaved:f,missingChildren:h}}.bind(this));return f},completePush:function(a,b,c,e){var f=this.local.getNodes([a]).then(function(f){var g=f[a];if(!g.push)throw this.stopped=!0,new Error("completePush called but no push version!");return c?(RemoteStorage.log("[Sync] We have a conflict"),g.remote&&g.remote.revision===e||(g.remote={revision:e,timestamp:this.now()}),f[a]=this.autoMerge(g)):(g.common={revision:e,timestamp:this.now()},"put"===b?(g.common.body=g.push.body,g.common.contentType=g.push.contentType,d(g.local.body,g.push.body)&&g.local.contentType===g.push.contentType&&delete g.local,delete g.push):"delete"===b&&(g.local.body===!1?f[a]=void 0:delete g.push)),this.local.setNodes(this.flush(f))}.bind(this));return f},dealWithFailure:function(a){return this.local.getNodes([a]).then(function(b){return b[a]?(delete b[a].push,this.local.setNodes(this.flush(b))):void 0}.bind(this))},interpretStatus:function(a){if("offline"===a||"timeout"===a)return{successful:!1,networkProblems:!0};var b=Math.floor(a/100);return{successful:2===b||304===a||412===a||404===a,conflict:412===a,unAuth:401===a||402===a||403===a,notFound:404===a,changed:304!==a}},handleGetResponse:function(a,b,c,d,f){return b.notFound&&(c=e(a)?{}:!1),b.changed?this.completeFetch(a,c,d,f).then(function(b){return e(a)?this.corruptServerItemsMap(c)?(RemoteStorage.log("[Sync] WARNING: Discarding corrupt folder description from server for "+a),!1):this.markChildren(a,c,b.toBeSaved,b.missingChildren).then(function(){return!0}):this.local.setNodes(this.flush(b.toBeSaved)).then(function(){return!0})}.bind(this)):promising().fulfill(!0)},handleResponse:function(a,b,c,d,e,f){var g=this.interpretStatus(c);if(g.successful){if("get"===b)return this.handleGetResponse(a,g,d,e,f);if("put"===b||"delete"===b)return this.completePush(a,b,g.conflict,f).then(function(){return!0});throw new Error("cannot handle response for unknown action",b)}return g.unAuth&&remoteStorage._emit("error",new RemoteStorage.Unauthorized),g.networkProblems&&remoteStorage._emit("error",new RemoteStorage.SyncError),this.dealWithFailure(a,b,g).then(function(){return!1})},numThreads:10,finishTask:function(a){return void 0===a.action?void delete this._running[a.path]:void a.promise.then(function(b,c,d,e){return this.handleResponse(a.path,a.action,b,c,d,e)}.bind(this),function(b){return RemoteStorage.log("[Sync] wireclient rejects its promise!",a.path,a.action,b),this.handleResponse(a.path,a.action,"offline")}.bind(this)).then(function(b){if(delete this._timeStarted[a.path],delete this._running[a.path],b&&this._tasks[a.path]){for(i=0;i<this._tasks[a.path].length;i++)this._tasks[a.path][i]();delete this._tasks[a.path]}this._emit("req-done"),this.collectTasks(!1).then(function(){!this.hasTasks()||this.stopped?(RemoteStorage.log("[Sync] Sync is done! Reschedule?",Object.getOwnPropertyNames(this._tasks).length,this.stopped),this.done||(this.done=!0,this._emit("done"))):setTimeout(function(){this.doTasks()}.bind(this),10)}.bind(this))}.bind(this),function(b){RemoteStorage.log("[Sync] Error",b),this.remote.online=!1,delete this._timeStarted[a.path],delete this._running[a.path],this._emit("req-done"),this.stopped||setTimeout(function(){this.doTasks()}.bind(this),0)}.bind(this))},doTasks:function(){var a,b,c,d=0;if(a=this.remote.connected?this.remote.online?this.numThreads:1:0,b=a-Object.getOwnPropertyNames(this._running).length,0>=b)return!0;for(c in this._tasks)if(!this._running[c]&&(this._timeStarted=this.now(),this._running[c]=this.doTask(c),this._running[c].then(this.finishTask.bind(this)),d++,d>=b))return!0;return d>=b},collectTasks:function(a){return this.hasTasks()||this.stopped?(promise=promising(),promise.fulfill(),promise):this.collectDiffTasks().then(function(b){return b||a===!1?(promise=promising(),promise.fulfill(),promise):this.collectRefreshTasks()}.bind(this),function(a){throw a})},addTask:function(a,b){this._tasks[a]||(this._tasks[a]=[]),"function"==typeof b&&this._tasks[a].push(b)},sync:function(){promising();return this.done=!1,this.doTasks()?promising().fulfill():this.collectTasks().then(function(){try{this.doTasks()}catch(a){RemoteStorage.log("[Sync] doTasks error",a)}}.bind(this),function(a){throw RemoteStorage.log("[Sync] Sync error",a),new Error("Local cache unavailable")})}},RemoteStorage.prototype.getSyncInterval=function(){return f},RemoteStorage.prototype.setSyncInterval=function(a){if("number"!=typeof a)throw a+" is not a valid sync interval";f=parseInt(a,10),this._syncTimer&&(this.stopSync(),this._syncTimer=setTimeout(this.syncCycle.bind(this),a))};var g=function(a){var b="Sync failed: ";b+="object"==typeof a&&"message"in a?a.message:a,this.originalError=a,Error.apply(this,[b])};g.prototype=Object.create(Error.prototype),RemoteStorage.SyncError=g,RemoteStorage.prototype.syncCycle=function(){this.sync.stopped||(this.sync.on("done",function(){RemoteStorage.log("[Sync] Sync done. Setting timer to",this.getSyncInterval()),this.sync.stopped||(this._syncTimer&&clearTimeout(this._syncTimer),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getSyncInterval()))}.bind(this)),this.sync.sync())},RemoteStorage.prototype.stopSync=function(){this.sync?(RemoteStorage.log("[Sync] Stopping sync"),this.sync.stopped=!0):(RemoteStorage.log("[Sync] Will instantiate sync stopped"),this.syncStopped=!0)},RemoteStorage.prototype.startSync=function(){this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync()};var h;RemoteStorage.Sync._rs_init=function(a){h=function(){RemoteStorage.log("[Sync] syncCycleCb calling syncCycle"),a.sync||(a.sync=new RemoteStorage.Sync(a.local,a.remote,a.access,a.caching),a.syncStopped&&(RemoteStorage.log("[Sync] Instantiating sync stopped"),a.sync.stopped=!0,delete a.syncStopped)),RemoteStorage.log("[Sync] syncCycleCb calling syncCycle"),a.syncCycle()},a.on("ready",h)},RemoteStorage.Sync._rs_cleanup=function(a){a.stopSync(),a.removeEventListener("ready",h)}}("undefined"!=typeof window?window:global),function(){function a(a){return"/"===a.substr(-1)}function b(a){return"/"!==a.substr(-1)}function c(a){return void 0===a?void 0:JSON.parse(JSON.stringify(a))}function d(a,b){return JSON.stringify(a)===JSON.stringify(b)}function e(b){if("object"==typeof b&&"string"==typeof b.path)if(a(b.path)){if(b.local&&b.local.itemsMap)return b.local;if(b.common&&b.common.itemsMap)return b.common}else{if(b.local&&b.local.body&&b.local.contentType)return b.local;if(b.common&&b.common.body&&b.common.contentType)return b.common;if(b.body&&b.contentType)return{body:b.body,contentType:b.contentType}}}function f(a,b){return!a||!a.timestamp||(new Date).getTime()-a.timestamp>b}function g(a){for(var b=[a],c=a.replace(/\/$/,"").split("/");c.length>1;)c.pop(),b.push(c.join("/")+"/");return b}function h(b,c){var d={path:b,common:{timestamp:c}};return a(b)&&(d.common.itemsMap={}),d}function i(a,b,d){return a.common||(a.common={timestamp:d,itemsMap:{}}),a.common.itemsMap||(a.common.itemsMap={}),a.local||(a.local=c(a.common)),a.local.itemsMap||(a.local.itemsMap=a.common.itemsMap),a.local.itemsMap[b]=!0,a}var j={get:function(a,b){var c=promising();return this.getNodes([a]).then(function(d){var g=e(d[a]);"number"==typeof b&&f(g,b)&&remoteStorage.sync.queueGetRequest(a,c),g?c.fulfill(200,g.body||g.itemsMap,g.contentType):c.fulfill(404)}.bind(this),function(a){c.reject(a)}.bind(this)),c},put:function(a,b,c){var d=g(a),f=(new Date).getTime();return this._updateNodes(d,function(a){try{for(var g=0;g<d.length;g++){var j,k=d[g],l=a[k];if(l||(a[k]=l=h(k,f)),0===g)j=e(l),l.local={body:b,contentType:c,timestamp:f,previousBody:j?j.body:void 0,previousContentType:j?j.contentType:void 0};else{var m=d[g-1].substring(k.length);l=i(l,m,f)}}return a}catch(n){throw RemoteStorage.log("[Cachinglayer] Error during PUT",a,g,n),n}})},"delete":function(a){var b=g(a);return this._updateNodes(b,function(a){for(var d=(new Date).getTime(),f=0;f<b.length;f++){var g=b[f],h=a[g];if(!h)throw new Error("Cannot delete non-existing node "+g);if(0===f)previous=e(h),h.local={body:!1,timestamp:d,previousBody:previous?previous.body:void 0,previousContentType:previous?previous.contentType:void 0};else{h.local||(h.local=c(h.common));var i=b[f-1].substring(g.length);if(delete h.local.itemsMap[i],Object.getOwnPropertyNames(h.local.itemsMap).length>0)break}}return a})},flush:function(a){return this._getAllDescendentPaths(a).then(function(a){return this.getNodes(a)}.bind(this)).then(function(a){for(var b in a){var c=a[b];c&&c.common&&c.local&&this._emit("change",{path:c.path,origin:"local",oldValue:c.local.body===!1?void 0:c.local.body,newValue:c.common.body===!1?void 0:c.common.body}),a[b]=void 0}return this.setNodes(a)}.bind(this))},fireInitial:function(){this.forAllNodes(function(a){var c;b(a.path)&&(c=e(a),c&&this._emit("change",{path:a.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:c.body,newContentType:c.contentType}))}.bind(this))},onDiff:function(a){this.diffHandler=a},migrate:function(a){return"object"!=typeof a||a.common||(a.common={},"string"==typeof a.path?"/"===a.path.substr(-1)&&"object"==typeof a.body&&(a.common.itemsMap=a.body):(a.local||(a.local={}),a.local.body=a.body,a.local.contentType=a.contentType)),a},_updateNodes:function(a,e){var f=this;return this.getNodes(a).then(function(a){var g,h=c(a),i=[];a=e(a);for(var j in a)g=a[j],d(g,h[j])?delete a[j]:b(j)&&(i.push({path:j,origin:"window",oldValue:g.local.previousBody,newValue:g.local.body===!1?void 0:g.local.body,oldContentType:g.local.previousContentType,newContentType:g.local.contentType}),delete g.local.previousBody,delete g.local.previousContentType);return f.setNodes(a).then(function(){return f._emitChangeEvents(i),200})},function(a){throw a})},_emitChangeEvents:function(a){for(var b=0;b<a.length;b++)this._emit("change",a[b]),this.diffHandler&&this.diffHandler(a[b].path)},_getAllDescendentPaths:function(b){return a(b)?this.getNodes([b]).then(function(a){var c=0,d=[b],f=e(a[b]),g=promising();for(var h in f.itemsMap)c++,this._getAllDescendentPaths(b+h).then(function(a){c--;for(var b=0;b<a.length;b++)d.push(a[b]);0===c&&g.fulfill(d)});return g}.bind(this)):promising().fulfill([b])},_getInternals:function(){return{isFolder:a,isDocument:b,deepClone:c,equal:d,getLatest:e,pathsFromRoot:g,makeNode:h}}};RemoteStorage.cachingLayer=function(a){for(var b in j)a[b]=j[b]}}(),function(a){var b,c=RemoteStorage,d=2,e="remotestorage";c.IndexedDB=function(a){return this.db=a||b,this.db?(c.cachingLayer(this),c.eventHandling(this,"change"),this.getsRunning=0,void(this.putsRunning=0)):void RemoteStorage.log("[IndexedDB] Failed to open DB")},c.IndexedDB.prototype={getNodes:function(a){{var b=promising(),c=this.db.transaction(["nodes"],"readonly"),d=c.objectStore("nodes"),e={};(new Date).getTime()}this.getsRunning++;for(var f=0;f<a.length;f++)!function(b){var c=a[b];d.get(c).onsuccess=function(a){e[c]=a.target.result}}(f);return c.oncomplete=function(){b.fulfill(e),this.getsRunning--}.bind(this),c.onerror=c.onabort=function(){b.reject("get transaction error/abort"),this.getsRunning--}.bind(this),b},setNodes:function(a){var b=promising(),c=this.db.transaction(["nodes"],"readwrite"),d=c.objectStore("nodes"),e=(new Date).getTime();this.putsRunning++,RemoteStorage.log("[IndexedDB] Starting put",a,this.putsRunning);for(var f in a){var g=a[f];if("object"==typeof g)try{d.put(g)}catch(h){throw RemoteStorage.log("[IndexedDB] Error while putting",g,h),h}else try{d.delete(f)}catch(h){throw RemoteStorage.log("[IndexedDB] Error while removing",d,g,h),h}}return c.oncomplete=function(){b.fulfill(),this.putsRunning--,RemoteStorage.log("[IndexedDB] Finished put",a,this.putsRunning,(new Date).getTime()-e+"ms")}.bind(this),c.onerror=function(){b.reject("transaction error"),this.putsRunning--}.bind(this),c.onabort=function(){b.reject("transaction abort"),this.putsRunning--}.bind(this),b},reset:function(a){var b=this.db.name,d=this;this.db.close(),c.IndexedDB.clean(this.db.name,function(){c.IndexedDB.open(b,function(b){d.db=b.db,a(d)})})},forAllNodes:function(a){var b=promising(),c=this.db.transaction(["nodes"],"readonly"),d=c.objectStore("nodes").openCursor();return d.onsuccess=function(c){var d=c.target.result;d?(a(this.migrate(d.value)),d.continue()):b.fulfill()}.bind(this),b},closeDB:function(){this.db.close()}},c.IndexedDB.open=function(a,b){var c=setTimeout(function(){b("timeout trying to open db")},1e4),e=indexedDB.open(a,d);e.onerror=function(){RemoteStorage.log("[IndexedDB] Opening DB failed",e),clearTimeout(c),b(e.error)},e.onupgradeneeded=function(a){var b=e.result;RemoteStorage.log("[IndexedDB] Upgrade: from ",a.oldVersion," to ",a.newVersion),1!==a.oldVersion&&(RemoteStorage.log("[IndexedDB] Creating object store: nodes"),b.createObjectStore("nodes",{keyPath:"path"})),RemoteStorage.log("[IndexedDB] Creating object store: changes"),b.createObjectStore("changes",{keyPath:"path"})},e.onsuccess=function(){clearTimeout(c),b(null,e.result)}},c.IndexedDB.clean=function(a,b){var c=indexedDB.deleteDatabase(a);c.onsuccess=function(){RemoteStorage.log("[IndexedDB] Done removing DB"),b()},c.onerror=c.onabort=function(b){console.error('Failed to remove database "'+a+'"',b)}},c.IndexedDB._rs_init=function(a){var d=promising();return c.IndexedDB.open(e,function(c,e){c?d.reject(c):(b=e,e.onerror=function(){a._emit("error",c)},d.fulfill())}),d},c.IndexedDB._rs_supported=function(){var b=promising();if("indexedDB"in a)try{var c=indexedDB.open("MyTestDatabase");c.onerror=function(){b.reject()},c.onsuccess=function(){b.fulfill()}}catch(d){b.reject()}else b.reject();return b},c.IndexedDB._rs_cleanup=function(a){var b=promising();return a.local&&a.local.closeDB(),c.IndexedDB.clean(e,function(){b.fulfill()}),b}}("undefined"!=typeof window?window:global),function(a){function b(a){return a.substr(0,d.length)===d||a.substr(0,e.length)===e}function c(a){return a.substr(0,d.length)===d}var d="remotestorage:cache:nodes:",e="remotestorage:cache:changes:";RemoteStorage.LocalStorage=function(){RemoteStorage.cachingLayer(this),RemoteStorage.log("[LocalStorage] Registering events"),RemoteStorage.eventHandling(this,"change")},RemoteStorage.LocalStorage.prototype={getNodes:function(a){var b=promising(),c={};for(i=0;i<a.length;i++)try{c[a[i]]=JSON.parse(localStorage[d+a[i]])}catch(e){c[a[i]]=void 0}return b.fulfill(c),b},setNodes:function(a){var b=promising();for(var c in a)localStorage[d+c]=JSON.stringify(a[c]);return b.fulfill(),b},forAllNodes:function(a){for(var b,d=0;d<localStorage.length;d++)if(c(localStorage.key(d))){try{b=this.migrate(JSON.parse(localStorage[localStorage.key(d)]))}catch(e){b=void 0}b&&a(b)}return promising().fulfill()}},RemoteStorage.LocalStorage._rs_init=function(){},RemoteStorage.LocalStorage._rs_supported=function(){return"localStorage"in a},RemoteStorage.LocalStorage._rs_cleanup=function(){for(var a=[],c=0;c<localStorage.length;c++){var d=localStorage.key(c);b(d)&&a.push(d)}a.forEach(function(a){RemoteStorage.log("[LocalStorage] Removing",a),delete localStorage[a]})}}("undefined"!=typeof window?window:global),function(){RemoteStorage.InMemoryStorage=function(){RemoteStorage.cachingLayer(this),RemoteStorage.log("[InMemoryStorage] Registering events"),RemoteStorage.eventHandling(this,"change"),this._storage={}},RemoteStorage.InMemoryStorage.prototype={getNodes:function(a){var b=promising(),c={};for(i=0;i<a.length;i++)c[a[i]]=this._storage[a[i]];return b.fulfill(c),b},setNodes:function(a){var b=promising();for(var c in a)void 0===a[c]?delete this._storage[c]:this._storage[c]=a[c];return b.fulfill(),b},forAllNodes:function(a){for(var b in this._storage)a(this.migrate(this._storage[b]));return promising().fulfill()}},RemoteStorage.InMemoryStorage._rs_init=function(){},RemoteStorage.InMemoryStorage._rs_supported=function(){return!0},RemoteStorage.InMemoryStorage._rs_cleanup=function(){}}("undefined"!=typeof window?window:global),function(){RemoteStorage.MODULES={},RemoteStorage.defineModule=function(a,b){if(RemoteStorage.MODULES[a]=b,Object.defineProperty(RemoteStorage.prototype,a,{configurable:!0,get:function(){var b=this._loadModule(a);return Object.defineProperty(this,a,{value:b}),b}}),-1!==a.indexOf("-")){var c=a.replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()});Object.defineProperty(RemoteStorage.prototype,c,{get:function(){return this[a]}})}},RemoteStorage.prototype._loadModule=function(a){var b=RemoteStorage.MODULES[a];if(b){var c=b(new RemoteStorage.BaseClient(this,"/"+a+"/"),new RemoteStorage.BaseClient(this,"/public/"+a+"/"));return c.exports}throw"Unknown module: "+a},RemoteStorage.prototype.defineModule=function(){console.log("remoteStorage.defineModule is deprecated, use RemoteStorage.defineModule instead!"),RemoteStorage.defineModule.apply(RemoteStorage,arguments)}}(),function(){function a(a,b,c){function d(a,b,c,d){[b,c,d].forEach(function(b){var c=document.createElement("td");c.textContent=b||"",a.appendChild(c)})}function e(a){function c(b,c,f,g){if(200===b){var i=document.createElement("tr");if(h.appendChild(i),d(i,a,f,g),"/"===a[a.length-1])for(var j in c)e(a+j)}}b.connected!==!1&&b.get(a).then(c)}a.setAttribute("border","1"),a.style.margin="8px",a.innerHTML="";var f=document.createElement("thead");a.appendChild(f);var g=document.createElement("tr");f.appendChild(g),["Path","Content-Type","Revision"].forEach(function(a){var b=document.createElement("th");b.textContent=a,f.appendChild(b)});var h=document.createElement("tbody");a.appendChild(h),c.forEach(e)}function b(b,c,d,e){var f=document.createElement("div"),g=document.createElement("h2");g.textContent=b,f.appendChild(g);var h=document.createElement("button");if(h.textContent="Refresh",h.onclick=function(){a(c,d,e)},f.appendChild(h),d.reset){var i=document.createElement("button");i.textContent="Reset",i.onclick=function(){d.reset(function(b){d=b,a(c,d,e)})},f.appendChild(i)}return f.appendChild(c),a(c,d,e),f}function c(a){function b(){a.changesBelow("/").then(function(a){f.innerHTML="",a.forEach(function(a){var b=document.createElement("li");b.textContent=JSON.stringify(a),f.appendChild(b)})})}var c=document.createElement("div"),d=document.createElement("h2");d.textContent="Outgoing changes",c.appendChild(d);var e=document.createElement("button");e.textContent="Refresh",c.appendChild(e);var f=document.createElement("ul");return f.style.fontFamily="courier",c.appendChild(f),e.onclick=b,b(),c}RemoteStorage.prototype.inspect=function(){var d=document.createElement("div");d.id="remotestorage-inspect",d.style.position="absolute",d.style.top=0,d.style.left=0,d.style.background="black",d.style.color="white",d.style.border="groove 5px #ccc";var e=document.createElement("div");e.style.position="absolute",e.style.top=0,e.style.left=0;var f=document.createElement("strong");f.textContent=" remotestorage.js inspector ",e.appendChild(f);var g;this.local&&(g=document.createElement("button"),g.textContent="Synchronize",e.appendChild(g));var h=document.createElement("button");h.textContent="Close",h.onclick=function(){document.body.removeChild(d)},e.appendChild(h),d.appendChild(e);var i=document.createElement("table"),j=document.createElement("table");d.appendChild(b("Remote",i,this.remote,this.caching.rootPaths)),this.local&&(d.appendChild(b("Local",j,this.local,["/"])),d.appendChild(c(this.local)),g.onclick=function(){this.log("sync clicked"),this.sync().then(function(){this.log("SYNC FINISHED"),a(j,this.local,["/"])}.bind(this),function(a){console.error("SYNC FAILED",a,a.stack)})}.bind(this)),document.body.appendChild(d)}}(),function(){var a={getEventEmitter:function(){var a={},b=Array.prototype.slice.call(arguments);return b.unshift(a),RemoteStorage.eventHandling.apply(RemoteStorage,b),a.emit=a._emit,a},extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){for(var c in b)a[c]=b[c]}),a},asyncEach:function(a,b){return this.asyncMap(a,b).then(function(){return a})},asyncMap:function(a,b){function c(){f++,f===e&&d.fulfill(g,h)}var d=promising(),e=a.length,f=0,g=[],h=[];return a.forEach(function(a,d){var e;try{e=b(a)}catch(f){c(),h[d]=f}"object"==typeof e&&"function"==typeof e.then?e.then(function(a){g[d]=a,c()},function(){h[d]=res,c()}):(c(),g[d]=e)}),d},containingFolder:function(a){var b=a.replace(/[^\/]+\/?$/,"");return b===a?null:b},isFolder:function(a){return"/"===a.substr(-1)},baseName:function(b){var c=b.split("/");return a.isFolder(b)?c[c.length-2]+"/":c[c.length-1]},bindAll:function(a){for(var b in this)"function"==typeof a[b]&&(a[b]=a[b].bind(a))}};Object.defineProperty(RemoteStorage.prototype,"util",{get:function(){return console.log("DEPRECATION WARNING: remoteStorage.util is deprecated and will be removed with the next major release."),a}})}(),function(){function a(a){return"/"===a.substr(-1)&&(a=a.substr(0,a.length-1)),decodeURIComponent(a)}function b(a){return a.replace(/[^\/]+\/?$/,"")}function c(a){var b=a.split("/");return"/"===a.substr(-1)?b[b.length-2]+"/":b[b.length-1]}var d=RemoteStorage,e="https://www.googleapis.com",f="https://accounts.google.com/o/oauth2/auth",g="https://www.googleapis.com/auth/drive",h="application/vnd.google-apps.folder",i="application/json; charset=UTF-8",j=function(a){this.maxAge=a,this._items={}};j.prototype={get:function(a){var b=this._items[a],c=(new Date).getTime();return b&&b.t>=c-this.maxAge?b.v:void 0},set:function(a,b){this._items[a]={v:b,t:(new Date).getTime()}}},d.GoogleDrive=function(a,b){d.eventHandling(this,"connected"),this.rs=a,this.clientId=b,this._fileIdCache=new j(300),setTimeout(function(){this.configure(void 0,void 0,void 0,localStorage["remotestorage:googledrive:token"])}.bind(this),0)},d.GoogleDrive.prototype={configure:function(a,b,c,d){d?(localStorage["remotestorage:googledrive:token"]=d,this.token=d,this.connected=!0,this._emit("connected")):(this.connected=!1,delete this.token,delete localStorage["remotestorage:googledrive:token"])},connect:function(){this.rs.setBackend("googledrive"),d.Authorize(f,g,String(d.Authorize.getLocation()),this.clientId)},get:function(a,b){return"/"===a.substr(-1)?this._getFolder(a,b):this._getFile(a,b)},put:function(a,b,c,d){function e(a,b){if(a)f.reject(a);else if(b.status>=200&&b.status<300){var c=JSON.parse(b.responseText);f.fulfill(200,void 0,c.mimeType,c.etag)}else f.reject("PUT failed with status "+b.status+" ("+b.responseText+")")}var f=promising();return this._getFileId(a,function(g,h){return g?void f.reject(g):void(h?this._updateFile(h,a,b,c,d,e):this._createFile(a,b,c,d,e))}),f},"delete":function(a){var b=promising();return this._getFileId(a,function(a,c){a?b.reject(a):c?this._request("DELETE",e+"/drive/v2/files/"+c,{},function(a,c){a?b.reject(a):200===c.status||204===c.status?b.fulfill(200):b.reject("Delete failed: "+c.status+" ("+c.responseText+")")}):b.fulfill(200)}),b},_updateFile:function(a,b,c,d,f,g){g=g.bind(this);var h={mimeType:d};this._request("PUT",e+"/upload/drive/v2/files/"+a+"?uploadType=resumable",{body:JSON.stringify(h),headers:{"Content-Type":"application/json; charset=UTF-8"}},function(a,b){a?g(a):this._request("PUT",b.getResponseHeader("Location"),{body:d.match(/^application\/json/)?JSON.stringify(c):c},g)})},_createFile:function(b,d,f,g,h){h=h.bind(this),this._getParentId(b,function(g,i){if(g)return void h(g);var j=c(b),k={title:a(j),mimeType:f,parents:[{kind:"drive#fileLink",id:i}]};this._request("POST",e+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(k),headers:{"Content-Type":"application/json; charset=UTF-8"}},function(a,b){a?h(a):this._request("POST",b.getResponseHeader("Location"),{body:f.match(/^application\/json/)?JSON.stringify(d):d},h)})})},_getFile:function(a){var b=promising();return this._getFileId(a,function(a,c){a?b.reject(a):this._getMeta(c,function(a,c){var d;if("object"==typeof c&&"string"==typeof c.etag&&(d=c.etag.substring(1,c.etag.length-1)),a)b.reject(a);else if(c.downloadUrl){var e={};c.mimeType.match(/charset=binary/)&&(e.responseType="blob"),this._request("GET",c.downloadUrl,e,function(a,e){if(a)b.reject(a);else{var f=e.response;if(c.mimeType.match(/^application\/json/))try{f=JSON.parse(f)}catch(g){}b.fulfill(200,f,c.mimeType,d)}})}else b.fulfill(200,"",c.mimeType,d)})}),b},_getFolder:function(a){var b=promising();return this._getFileId(a,function(c,d){var f,g,j,k,l,m;c?b.reject(c):d?(f="'"+d+"' in parents",g="items(downloadUrl,etag,fileSize,id,mimeType,title)",this._request("GET",e+"/drive/v2/files?q="+encodeURIComponent(f)+"&fields="+encodeURIComponent(g)+"&maxResults=1000",{},function(c,d){if(c)b.reject(c);else if(200===d.status){try{j=JSON.parse(d.responseText)}catch(e){return void b.reject("non-JSON response from GoogleDrive")}for(m={},k=0;k<j.items.length;k++)l=j.items[k].etag.substring(1,j.items[k].etag.length-1),j.items[k].mimeType===h?(this._fileIdCache.set(a+j.items[k].title+"/",j.items[k].id),m[j.items[k].title+"/"]={ETag:l}):(this._fileIdCache.set(a+j.items[k].title,j.items[k].id),m[j.items[k].title]={ETag:l,"Content-Type":j.items[k].mimeType,"Content-Length":j.items[k].fileSize});b.fulfill(200,m,i,void 0)}else b.reject("request failed or something: "+d.status)})):b.fulfill(404)}),b},_getParentId:function(a,c){c=c.bind(this);
var d=b(a);this._getFileId(d,function(a,b){a?c(a):b?c(null,b):this._createFolder(d,c)})},_createFolder:function(b,d){d=d.bind(this),this._getParentId(b,function(f,g){f?d(f):this._request("POST",e+"/drive/v2/files",{body:JSON.stringify({title:a(c(b)),mimeType:h,parents:[{id:g}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}},function(a,b){if(a)d(a);else{var c=JSON.parse(b.responseText);d(null,c.id)}})})},_getFileId:function(a,c){c=c.bind(this);var d;"/"===a?c(null,"root"):(d=this._fileIdCache.get(a))?c(null,d):this._getFolder(b(a)).then(function(){var b=this._fileIdCache.get(a);return b?void c(null,b):void c("no file or folder found at the path: "+a,null)}.bind(this),c)},_getMeta:function(a,b){b=b.bind(this),this._request("GET",e+"/drive/v2/files/"+a,{},function(c,d){c?b(c):200===d.status?b(null,JSON.parse(d.responseText)):b("request (getting metadata for "+a+") failed with status: "+d.status)})},_request:function(a,b,c,e){e=e.bind(this),c.headers||(c.headers={}),c.headers.Authorization="Bearer "+this.token,d.WireClient.request.call(this,a,b,c,function(a,b){return b&&401===b.status?void this.connect():void e(a,b)})}},d.GoogleDrive._rs_init=function(a){var b=a.apiKeys.googledrive;b&&(a.googledrive=new d.GoogleDrive(a,b.client_id),"googledrive"===a.backend&&(a._origRemote=a.remote,a.remote=a.googledrive))},d.GoogleDrive._rs_supported=function(){return!0},d.GoogleDrive._rs_cleanup=function(a){a.setBackend(void 0),a._origRemote&&(a.remote=a._origRemote,delete a._origRemote)}}(this),function(a){function b(a){this.defaultValue=a,this._storage={},this.set=this.justSet,this.delete=this.justDelete}function c(a){a._dropboxOrigSync||(a._dropboxOrigSync=a.sync.bind(a),a.sync=function(){return this.dropbox.fetchDelta.apply(this.dropbox,arguments).then(a._dropboxOrigSync,function(b){a._emit("error",new a.SyncError(b))})})}function d(a){a._dropboxOrigSync&&(a.sync=a._dropboxOrigSync,delete a._dropboxOrigSync)}function e(a){a._origBaseClientGetItemURL||(a._origBaseClientGetItemURL=l.BaseClient.prototype.getItemURL,l.BaseClient.prototype.getItemURL=function(b){var c=a.dropbox._itemRefs[b];return c?c:""})}function f(a){a._origBaseClieNtGetItemURL&&(l.BaseClient.prototype.getItemURL=a._origBaseClietGetItemURL,delete a._origBaseClietGetItemURL)}function g(a){a._origRemote||(a._origRemote=a.remote,a.remote=a.dropbox)}function h(a){a._origRemote&&(a.remote=a._origRemote,delete a._origRemote)}function i(a){g(a),a.sync&&c(a),e(a)}function j(a){h(a),d(a),f(a)}var k,l=RemoteStorage,m="https://www.dropbox.com/1/oauth2/authorize",n="remotestorage:dropbox",o=l.WireClient.cleanPath;b.prototype={get:function(a){a=a.toLowerCase();var b=this._storage[a];return"undefined"==typeof b&&(b=this.defaultValue,this._storage[a]=b),b},propagateSet:function(a,b){return a=a.toLowerCase(),this._storage[a]===b?b:(this._propagate(a,b),this._storage[a]=b)},propagateDelete:function(a){return a=a.toLowerCase(),this._propagate(a,this._storage[a]),delete this._storage[a]},_activatePropagation:function(){return this.set=this.propagateSet,this.delete=this.propagateDelete,!0},justSet:function(a,b){return a=a.toLowerCase(),this._storage[a]=b},justDelete:function(a){return a=a.toLowerCase(),delete this._storage[a]},_propagate:function(a,b){for(var c=a.split("/").slice(0,-1),d=c.length,e="",f=0;d>f;f++)e+=c[f]+"/",b||(b=this._storage[e]+1),this._storage[e]=b}};var p;l.Dropbox=function(a){this.rs=a,this.connected=!1,this.rs=a;var c=this;if(p=function(a){a instanceof RemoteStorage.Unauthorized&&c.configure(null,null,null,null)},l.eventHandling(this,"change","connected"),a.on("error",p),this.clientId=a.apiKeys.dropbox.api_key,this._revCache=new b("rev"),this._itemRefs={},k){var d;try{d=JSON.parse(localStorage[n])}catch(e){}d&&this.configure(d.userAddress,void 0,void 0,d.token);try{this._itemRefs=JSON.parse(localStorage[n+":shares"])}catch(e){}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")},l.Dropbox.prototype={connect:function(){this.rs.setBackend("dropbox"),this.token?i(this.rs):l.Authorize(m,"",String(l.Authorize.getLocation()),this.clientId)},configure:function(a,b,c,d){RemoteStorage.log("dropbox configure",arguments),"undefined"!=typeof d&&(this.token=d),"undefined"!=typeof a&&(this.userAddress=a),this.token?(this.connected=!0,this.userAddress||this.info().then(function(a){this.userAddress=a.display_name}.bind(this)),this._emit("connected")):this.connected=!1,k&&(localStorage[n]=JSON.stringify({token:this.token,userAddress:this.userAddress}))},_getFolder:function(a){var b="https://api.dropbox.com/1/metadata/auto"+a,c=promising(),d=this._revCache;return this._request("GET",b,{},function(b,e){if(b)c.reject(b);else{var f=e.status;if(304===f)return void c.fulfill(f);var g,h,i,j;try{h=JSON.parse(e.responseText)}catch(k){return void c.reject(k)}j=this._revCache.get(a),i="application/json; charset=UTF-8",h.contents&&(g=h.contents.reduce(function(b,c){var e=c.path.split("/").slice(-1)[0]+(c.is_dir?"/":"");return b[e]=c.is_dir?d.get(a+e):c.rev,b},{})),c.fulfill(f,g,i,j)}}),c},get:function(a,b){if(RemoteStorage.log("dropbox.get",arguments),!this.connected)throw new Error("not connected (path: "+a+")");a=o(a);var c="https://api-content.dropbox.com/1/files/auto"+a,d=this._sharePromise(a),e=this._revCache.get(a);return null===e?(RemoteStorage.log(a," deleted 404"),d.fulfill(404),d):b&&b.ifNoneMatch&&e&&e===b.ifNoneMatch?(RemoteStorage.log("nothing changed for",a,e,b.ifNoneMatch),d.fulfill(304),d):"/"===a.substr(-1)?this._getFolder(a,b):(this._request("GET",c,{},function(b,c){if(b)d.reject(b);else{var e,f,g,h,i=c.status;if(404===i)d.fulfill(404);else if(200===i){f=c.responseText;try{e=JSON.parse(c.getResponseHeader("x-dropbox-metadata"))}catch(j){return void d.reject(j)}if(g=e.mime_type,h=e.rev,this._revCache.set(a,h),!c.getResponseHeader("Content-Type")||c.getResponseHeader("Content-Type").match(/charset=binary/))l.WireClient.readBinaryData(c.response,g,function(a){d.fulfill(i,a,g,h)});else{try{f=JSON.parse(f),g="application/json; charset=UTF-8"}catch(j){l.log("Failed parsing Json, assume it is something else then",g,a)}d.fulfill(i,f,g,h)}}else d.fulfill(i)}}),d)},put:function(a,b,c,d){if(RemoteStorage.log("dropbox.put",arguments),!this.connected)throw new Error("not connected (path: "+a+")");a=o(a);var e=this._sharePromise(a),f=this._revCache,g=f.get(a);if(d&&d.ifMatch&&g&&g!==d.ifMatch)return e.fulfill(412),e;c.match(/charset=/)||(c+="; charset="+(b instanceof ArrayBuffer||l.WireClient.isArrayBufferView(b)?"binary":"utf-8"));var h="https://api-content.dropbox.com/1/files_put/auto"+a+"?";return d&&d.ifMatch&&(h+="parent_rev="+encodeURIComponent(d.ifMatch)),b.length>157286400?RemoteStorage.log("files larger than 150MB not supported yet"):this._request("PUT",h,{body:b,headers:{"Content-Type":c}},function(b,c){if(b)e.reject(b);else{var d=JSON.parse(c.responseText);d.path!==a?(e.fulfill(412),this.rs.log("Dropbox created conflicting File ",d.path)):(f.set(a,d.rev),e.fulfill(c.status))}}),e},"delete":function(a,b){if(RemoteStorage.log("dropbox.delete ",arguments),!this.connected)throw new Error("not connected (path: "+a+")");a=o(a);var c=promising(),d=this._revCache,e=d.get(a);if(b.ifMatch&&e&&b.ifMatch!==e)return c.fulfill(412),c;var f="https://api.dropbox.com/1/fileops/delete?root=auto&path="+encodeURIComponent(a);return this._request("POST",f,{},function(b,e){b?c.reject(error):(c.fulfill(e.status),d.delete(a))}),c.then(function(){var b=Array.prototype.slice.call(arguments);delete this._itemRefs[a];var c=promising();return c.fulfill.apply(c,b)}.bind(this))},_sharePromise:function(a){var b=promising(),c=this;return a.match(/^\/public\/.*[^\/]$/)&&"undefined"==typeof this._itemRefs[a]&&(RemoteStorage.log("shareing this one ",a),b.then(function(){var b=Array.prototype.slice.call(arguments),d=promising();return RemoteStorage.log("calling share now"),c.share(a).then(function(){RemoteStorage.log("shareing fullfilled promise",arguments),d.fulfill.apply(d,b)},function(a){RemoteStorage.log("shareing failed",a),d.fulfill.apply(d,b)}),d})),b},share:function(a){var b="https://api.dropbox.com/1/media/auto"+a,c=promising(),d=this._itemRefs;return this._request("POST",b,{},function(b,e){if(b)RemoteStorage.log(b),b.message='Shareing Dropbox Thingie("'+a+'") failed'+b.message,c.reject(b);else try{var f=JSON.parse(e.responseText),g=f.url;d[a]=g,RemoteStorage.log("SHAREING URL :::: ",g," for ",a),k&&(localStorage[n+":shares"]=JSON.stringify(this._itemRefs)),c.fulfill(g)}catch(b){b.message+="share error",c.reject(b)}}),c},info:function(){var a="https://api.dropbox.com/1/account/info",b=promising();return this._request("GET",a,{},function(a,c){if(a)b.reject(a);else try{var d=JSON.parse(c.responseText);b.fulfill(d)}catch(e){b.reject(a)}}),b},_request:function(b,c,d,e){e=e.bind(this),d.headers||(d.headers={}),d.headers.Authorization="Bearer "+this.token,l.WireClient.request.call(this,b,c,d,function(f,g){g&&503===g.status?a.setTimeout(this._request(b,c,d,e),3210):e(f,g)})},fetchDelta:function(){var a=Array.prototype.slice.call(arguments),c=promising(),d=this;return this._request("POST","https://api.dropbox.com/1/delta",{body:this._deltaCursor?"cursor="+encodeURIComponent(this._deltaCursor):"",headers:{"Content-Type":"application/x-www-form-urlencoded"}},function(e,f){if(e)this.rs.log("fetchDeltas",e),this.rs._emit("error",new RemoteStorage.SyncError("fetchDeltas failed"+e)),c.reject(e);else{if(200!==f.status)return 400===f.status?(this.rs._emit("error",new RemoteStorage.Unauthorized),c.fulfill.apply(c,a)):(RemoteStorage.log("!!!!dropbox.fetchDelta returned "+f.status+f.responseText),c.reject("dropbox.fetchDelta returned "+f.status+f.responseText)),c;var g;try{g=JSON.parse(f.responseText)}catch(e){return l.log("fetchDeltas can not parse response",e),c.reject("can not parse response of fetchDelta : "+e.message)}if(!g.entries)return RemoteStorage.log("!!!!!DropBox.fetchDeltas() NO ENTRIES FOUND!!",g),c.reject("dropbox.fetchDeltas failed, no entries found");g.reset&&(this._revCache=new b("rev"),c.then(function(){var a=Array.prototype.slice.call(arguments);d._revCache._activatePropagation();var b=promising();return b.fulfill.apply(b,a)})),g.cursor&&(this._deltaCursor=g.cursor),RemoteStorage.log("Delta : ",g.entries),g.entries.forEach(function(a){var b,c=a[0];if(a[1]){if(a[1].is_dir)return;b=a[1].rev}else b=null;d._revCache.set(c,b)}),c.fulfill.apply(c,a)}}),c}},l.Dropbox._rs_init=function(a){k=a.localStorageAvailable(),a.apiKeys.dropbox&&(a.dropbox=new l.Dropbox(a)),"dropbox"===a.backend&&i(a)},l.Dropbox._rs_supported=function(){return!0},l.Dropbox._rs_cleanup=function(a){j(a),k&&delete localStorage[n],a.removeEventListener("error",p),a.setBackend(void 0)}}(this),remoteStorage=new RemoteStorage,RemoteStorage.defineModule("bookmarks",function(a){var b,c=remoteStorage.util.extend,d={id:{type:"string"},url:{type:"string",format:"uri",required:!0},title:{type:"string",required:!0},createdAt:{type:"date","default":null}};a.declareType("archive-bookmark",{type:"object",properties:c({description:{type:"string","default":""},tags:{type:"array","default":[]},thumbnail:{description:"A base64-encoded screenshot of the bookmarked page",type:"string","default":null}},d)}),a.declareType("browser-bookmark",{type:"object",properties:c({tags:{type:"array","default":[]}},d)}),a.declareType("readlater-bookmark",{type:"object",properties:c({unread:{type:"boolean","default":!0,required:!0}},d)});var e={archive:{find:function(b){var c="archive/"+b;return a.getObject(c).then(function(a){return a})},getAll:function(){return a.getAll("archive/").then(function(a){return a?Object.keys(a).map(function(b){return a[b]}):[]},function(a){console.log("Something bad happened: ",a)})},store:function(b){b.id=f(b.url),b.createdAt?b.updatedAt=new Date:b.createdAt=new Date;var c="archive/"+b.id;return a.storeObject("archive-bookmark",c,b).then(function(){return console.log(b.id),b})},remove:function(b){var c="archive/"+b;return a.remove(c)},idForUrl:function(a){return f(a)}},client:a},f=function(a){return a=a,b(a)};return b=function(a){function b(a,b){var c=a[0],h=a[1],i=a[2],j=a[3];c=d(c,h,i,j,b[0],7,-680876936),j=d(j,c,h,i,b[1],12,-389564586),i=d(i,j,c,h,b[2],17,606105819),h=d(h,i,j,c,b[3],22,-1044525330),c=d(c,h,i,j,b[4],7,-176418897),j=d(j,c,h,i,b[5],12,1200080426),i=d(i,j,c,h,b[6],17,-1473231341),h=d(h,i,j,c,b[7],22,-45705983),c=d(c,h,i,j,b[8],7,1770035416),j=d(j,c,h,i,b[9],12,-1958414417),i=d(i,j,c,h,b[10],17,-42063),h=d(h,i,j,c,b[11],22,-1990404162),c=d(c,h,i,j,b[12],7,1804603682),j=d(j,c,h,i,b[13],12,-40341101),i=d(i,j,c,h,b[14],17,-1502002290),h=d(h,i,j,c,b[15],22,1236535329),c=e(c,h,i,j,b[1],5,-165796510),j=e(j,c,h,i,b[6],9,-1069501632),i=e(i,j,c,h,b[11],14,643717713),h=e(h,i,j,c,b[0],20,-373897302),c=e(c,h,i,j,b[5],5,-701558691),j=e(j,c,h,i,b[10],9,38016083),i=e(i,j,c,h,b[15],14,-660478335),h=e(h,i,j,c,b[4],20,-405537848),c=e(c,h,i,j,b[9],5,568446438),j=e(j,c,h,i,b[14],9,-1019803690),i=e(i,j,c,h,b[3],14,-187363961),h=e(h,i,j,c,b[8],20,1163531501),c=e(c,h,i,j,b[13],5,-1444681467),j=e(j,c,h,i,b[2],9,-51403784),i=e(i,j,c,h,b[7],14,1735328473),h=e(h,i,j,c,b[12],20,-1926607734),c=f(c,h,i,j,b[5],4,-378558),j=f(j,c,h,i,b[8],11,-2022574463),i=f(i,j,c,h,b[11],16,1839030562),h=f(h,i,j,c,b[14],23,-35309556),c=f(c,h,i,j,b[1],4,-1530992060),j=f(j,c,h,i,b[4],11,1272893353),i=f(i,j,c,h,b[7],16,-155497632),h=f(h,i,j,c,b[10],23,-1094730640),c=f(c,h,i,j,b[13],4,681279174),j=f(j,c,h,i,b[0],11,-358537222),i=f(i,j,c,h,b[3],16,-722521979),h=f(h,i,j,c,b[6],23,76029189),c=f(c,h,i,j,b[9],4,-640364487),j=f(j,c,h,i,b[12],11,-421815835),i=f(i,j,c,h,b[15],16,530742520),h=f(h,i,j,c,b[2],23,-995338651),c=g(c,h,i,j,b[0],6,-198630844),j=g(j,c,h,i,b[7],10,1126891415),i=g(i,j,c,h,b[14],15,-1416354905),h=g(h,i,j,c,b[5],21,-57434055),c=g(c,h,i,j,b[12],6,1700485571),j=g(j,c,h,i,b[3],10,-1894986606),i=g(i,j,c,h,b[10],15,-1051523),h=g(h,i,j,c,b[1],21,-2054922799),c=g(c,h,i,j,b[8],6,1873313359),j=g(j,c,h,i,b[15],10,-30611744),i=g(i,j,c,h,b[6],15,-1560198380),h=g(h,i,j,c,b[13],21,1309151649),c=g(c,h,i,j,b[4],6,-145523070),j=g(j,c,h,i,b[11],10,-1120210379),i=g(i,j,c,h,b[2],15,718787259),h=g(h,i,j,c,b[9],21,-343485551),a[0]=m(c,a[0]),a[1]=m(h,a[1]),a[2]=m(i,a[2]),a[3]=m(j,a[3])}function c(a,b,c,d,e,f){return b=m(m(b,a),m(d,f)),m(b<<e|b>>>32-e,c)}function d(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)}function e(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)}function f(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)}function g(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)}function h(a){txt="";var c,d=a.length,e=[1732584193,-271733879,-1732584194,271733878];for(c=64;c<=a.length;c+=64)b(e,i(a.substring(c-64,c)));a=a.substring(c-64);var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(c=0;c<a.length;c++)f[c>>2]|=a.charCodeAt(c)<<(c%4<<3);if(f[c>>2]|=128<<(c%4<<3),c>55)for(b(e,f),c=0;16>c;c++)f[c]=0;return f[14]=8*d,b(e,f),e}function i(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function j(a){for(var b="",c=0;4>c;c++)b+=n[a>>8*c+4&15]+n[a>>8*c&15];return b}function k(a){for(var b=0;b<a.length;b++)a[b]=j(a[b]);return a.join("")}function l(a){return k(h(a))}function m(a,b){return a+b&4294967295}function m(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}var n="0123456789abcdef".split("");return"5d41402abc4b2a76b9719d911017c592"!==l("hello"),l(a)},{exports:e}});